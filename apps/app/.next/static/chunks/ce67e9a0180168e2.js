(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,95187,(e,t,r)=>{"use strict";Object.defineProperty(r,"__esModule",{value:!0});var a={callServer:function(){return l.callServer},createServerReference:function(){return i.createServerReference},findSourceMapURL:function(){return n.findSourceMapURL}};for(var s in a)Object.defineProperty(r,s,{enumerable:!0,get:a[s]});let l=e.r(32120),n=e.r(92245),i=e.r(35326)},73741,48425,e=>{"use strict";var t=e.i(71645);e.i(74080);var r=e.i(91918),a=e.i(18050),s=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"].reduce((e,s)=>{let l=(0,r.createSlot)(`Primitive.${s}`),n=t.forwardRef((e,t)=>{let{asChild:r,...n}=e;return"undefined"!=typeof window&&(window[Symbol.for("radix-ui")]=!0),(0,a.jsx)(r?l:s,{...n,ref:t})});return n.displayName=`Primitive.${s}`,{...e,[s]:n}},{});e.s(["Primitive",()=>s],48425);var l=t.forwardRef((e,t)=>(0,a.jsx)(s.label,{...e,ref:t,onMouseDown:t=>{t.target.closest("button, input, select, textarea")||(e.onMouseDown?.(t),!t.defaultPrevented&&t.detail>1&&t.preventDefault())}}));l.displayName="Label",e.s(["Label",()=>l,"Root",()=>l],73741)},30406,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(73741),s=e.i(97495);let l=r.forwardRef(({className:e,...r},l)=>(0,t.jsx)(a.Root,{ref:l,className:(0,s.cn)("text-xs font-semibold uppercase tracking-[0.25em] text-slate-400",e),...r}));l.displayName=a.Root.displayName,e.s(["Label",()=>l])},68340,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(97495);let s=r.forwardRef(({className:e,type:r="text",...s},l)=>(0,t.jsx)("input",{type:r,className:(0,a.cn)("flex h-10 w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900 placeholder:text-slate-400 shadow-sm transition focus:border-primary focus:outline-none focus:ring-2 focus:ring-primary/30 disabled:cursor-not-allowed disabled:opacity-60 dark:bg-slate-950 dark:text-slate-50 dark:border-slate-800 dark:placeholder:text-slate-400",e),ref:l,...s}));s.displayName="Input",e.s(["Input",()=>s])},35804,e=>{"use strict";var t=e.i(71645),r=e.i(34620);function a(e){let[a,s]=t.useState(void 0);return(0,r.useLayoutEffect)(()=>{if(e){s({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,a;if(!Array.isArray(t)||!t.length)return;let l=t[0];if("borderBoxSize"in l){let e=l.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,a=t.blockSize}else r=e.offsetWidth,a=e.offsetHeight;s({width:r,height:a})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}s(void 0)},[e]),a}e.s(["useSize",()=>a])},99682,e=>{"use strict";var t=e.i(71645);function r(e){let r=t.useRef({value:e,previous:e});return t.useMemo(()=>(r.current.value!==e&&(r.current.previous=r.current.value,r.current.value=e),r.current.previous),[e])}e.s(["usePrevious",()=>r])},18494,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(26999),s=e.i(97495);let l=a.Root,n=a.Trigger,i=a.Portal,d=a.Close,c=r.forwardRef(({className:e,...r},l)=>(0,t.jsx)(a.Overlay,{ref:l,className:(0,s.cn)("fixed inset-0 z-50 bg-slate-950/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out",e),...r}));c.displayName=a.Overlay.displayName;let o=r.forwardRef(({className:e,children:r,...l},n)=>(0,t.jsxs)(i,{children:[(0,t.jsx)(c,{}),(0,t.jsx)(a.Content,{ref:n,className:(0,s.cn)("fixed left-1/2 top-1/2 z-50 w-[calc(100%-2rem)] max-w-xl -translate-x-1/2 -translate-y-1/2 rounded-3xl border border-slate-200 bg-white p-8 text-slate-900 shadow-2xl backdrop-blur data-[state=open]:animate-in data-[state=closed]:animate-out dark:border-white/10 dark:bg-slate-950/95 dark:text-slate-100",e),...l,children:r})]}));o.displayName=a.Content.displayName;let u=({className:e,...r})=>(0,t.jsx)("div",{className:(0,s.cn)("mb-6 flex flex-col gap-2 text-center sm:text-left",e),...r});u.displayName="DialogHeader";let m=({className:e,...r})=>(0,t.jsx)("div",{className:(0,s.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...r});m.displayName="DialogFooter";let x=r.forwardRef(({className:e,...r},l)=>(0,t.jsx)(a.Title,{ref:l,className:(0,s.cn)("text-xl font-semibold text-slate-900 dark:text-slate-50",e),...r}));x.displayName=a.Title.displayName;let f=r.forwardRef(({className:e,...r},l)=>(0,t.jsx)(a.Description,{ref:l,className:(0,s.cn)("text-sm text-slate-500 dark:text-slate-400",e),...r}));f.displayName=a.Description.displayName,e.s(["Dialog",()=>l,"DialogClose",()=>d,"DialogContent",()=>o,"DialogDescription",()=>f,"DialogFooter",()=>m,"DialogHeader",()=>u,"DialogTitle",()=>x,"DialogTrigger",()=>n])},27612,e=>{"use strict";let t=(0,e.i(75254).default)("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],27612)},7233,e=>{"use strict";let t=(0,e.i(75254).default)("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},47151,e=>{"use strict";var t=e.i(18050),r=e.i(71645),a=e.i(97495),s=e.i(3420),l=e.i(18494),n=e.i(68340),i=e.i(30406),d=e.i(1781),c=e.i(95187),o=(0,c.createServerReference)("4051358d725b4044b4fdbd74318bae0cb8a8202223",c.callServer,void 0,c.findSourceMapURL,"createRole"),u=(0,c.createServerReference)("6063814e7fe3c93c0a64c2da9f1839dde3930ad582",c.callServer,void 0,c.findSourceMapURL,"updateRole"),m=e.i(7233);function x({role:e,trigger:a,target:c="staff"}){let[x,f]=(0,r.useState)(!1),[g,h]=(0,r.useState)(!1),[p,v]=(0,r.useState)(""),[b,y]=(0,r.useState)({can_manage_roles:!1,can_manage_users:!1,can_manage_settings:!1,can_use_timecard:!1,can_manage_attendance:!1,can_view_dashboard:!1,can_manage_menus:!1,target:c});(0,r.useEffect)(()=>{x&&e?(v(e.name),y({can_manage_roles:e.permissions?.can_manage_roles||!1,can_manage_users:e.permissions?.can_manage_users||!1,can_manage_settings:e.permissions?.can_manage_settings||!1,can_use_timecard:e.permissions?.can_use_timecard||!1,can_manage_attendance:e.permissions?.can_manage_attendance||!1,can_view_dashboard:e.permissions?.can_view_dashboard||!1,can_manage_menus:e.permissions?.can_manage_menus||!1,target:e.permissions?.target==="cast"?"cast":"staff"})):x&&!e&&(v(""),y({can_manage_roles:!1,can_manage_users:!1,can_manage_settings:!1,can_use_timecard:"cast"===c,can_manage_attendance:!1,can_view_dashboard:!1,can_manage_menus:!1,target:c}))},[x,e,c]);let k=async t=>{t.preventDefault(),h(!0);try{let t={name:p,permissions:b};e?await u(e.id,t):await o(t),f(!1)}catch(e){console.error(e),alert("エラーが発生しました")}finally{h(!1)}};return(0,t.jsxs)(l.Dialog,{open:x,onOpenChange:f,children:[(0,t.jsx)(l.DialogTrigger,{asChild:!0,children:a||(0,t.jsxs)(s.Button,{className:"whitespace-nowrap",children:[(0,t.jsx)(m.Plus,{className:"mr-2 h-4 w-4"}),"新規作成"]})}),(0,t.jsx)(l.DialogContent,{className:"bg-transparent p-0 text-slate-900 dark:text-white px-4 sm:px-0",children:(0,t.jsxs)("div",{className:"w-full max-w-md sm:max-w-xl mx-auto rounded-3xl bg-white dark:bg-gray-800 p-6 sm:p-8 shadow-2xl border border-gray-200 dark:border-gray-700",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{className:"text-slate-900 dark:text-white",children:e?"ロールを編集":"新規ロール作成"}),(0,t.jsx)(l.DialogDescription,{className:"text-slate-500 dark:text-gray-400",children:"ロール名と権限を設定してください。"})]}),(0,t.jsxs)("form",{onSubmit:k,className:"space-y-4",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{htmlFor:"name",className:"text-gray-900 dark:text-gray-200",children:"ロール名"}),(0,t.jsx)(n.Input,{id:"name",value:p,onChange:e=>v(e.target.value),placeholder:"例: 店長",required:!0,className:"bg-white dark:bg-gray-900 border-gray-200 dark:border-gray-700 text-gray-900 dark:text-white placeholder:text-gray-400"})]}),(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(i.Label,{className:"text-gray-900 dark:text-gray-200",children:"権限設定"}),(0,t.jsxs)("div",{className:"space-y-2 border border-gray-200 dark:border-gray-700 rounded-md p-4 bg-gray-50 dark:bg-gray-900/50",children:["staff"===c&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_manage_roles",checked:b.can_manage_roles,onCheckedChange:e=>y(t=>({...t,can_manage_roles:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_manage_roles",className:"text-gray-700 dark:text-gray-300",children:"権限管理 (ロールの作成・編集)"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_manage_users",checked:b.can_manage_users,onCheckedChange:e=>y(t=>({...t,can_manage_users:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_manage_users",className:"text-gray-700 dark:text-gray-300",children:"プロフィール情報 (スタッフ・キャストの追加)"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_manage_settings",checked:b.can_manage_settings,onCheckedChange:e=>y(t=>({...t,can_manage_settings:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_manage_settings",className:"text-gray-700 dark:text-gray-300",children:"店舗設定 (基本情報の変更)"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_manage_attendance",checked:b.can_manage_attendance,onCheckedChange:e=>y(t=>({...t,can_manage_attendance:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_manage_attendance",className:"text-gray-700 dark:text-gray-300",children:"勤怠"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_view_dashboard",checked:b.can_view_dashboard,onCheckedChange:e=>y(t=>({...t,can_view_dashboard:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_view_dashboard",className:"text-gray-700 dark:text-gray-300",children:"ダッシュボード閲覧"})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_manage_menus",checked:b.can_manage_menus,onCheckedChange:e=>y(t=>({...t,can_manage_menus:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_manage_menus",className:"text-gray-700 dark:text-gray-300",children:"メニュー管理"})]})]}),(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)(d.Checkbox,{id:"can_use_timecard",checked:b.can_use_timecard,onCheckedChange:e=>y(t=>({...t,can_use_timecard:e})),className:"border-gray-300 dark:border-gray-600 data-[state=checked]:bg-primary data-[state=checked]:border-primary"}),(0,t.jsx)(i.Label,{htmlFor:"can_use_timecard",className:"text-gray-700 dark:text-gray-300",children:"タイムカード利用"})]})]})]}),(0,t.jsxs)(l.DialogFooter,{className:"gap-2",children:[(0,t.jsx)(s.Button,{type:"button",variant:"outline",onClick:()=>f(!1),children:"キャンセル"}),(0,t.jsx)(s.Button,{type:"submit",disabled:g,children:g?"保存中...":"保存"})]})]})]})})]})}var f=e.i(98919),g=e.i(27612),h=e.i(75254);let p=(0,h.default)("Pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);var v=/[\\\/_+.#"@\[\(\{&]/,b=/[\\\/_+.#"@\[\(\{&]/g,y=/[\s-]/,k=/[\s-]/g;function j(e){return e.toLowerCase().replace(k," ")}var w=e.i(26999),_=e.i(48425),N=e.i(10772),C=e.i(20783),S='[cmdk-group=""]',R='[cmdk-group-items=""]',E='[cmdk-item=""]',D=`${E}:not([aria-disabled="true"])`,I="cmdk-item-select",M="data-value",P=(e,t,r)=>{var a;return a=e,function e(t,r,a,s,l,n,i){if(n===r.length)return l===t.length?1:.99;var d=`${l},${n}`;if(void 0!==i[d])return i[d];for(var c,o,u,m,x=s.charAt(n),f=a.indexOf(x,l),g=0;f>=0;)(c=e(t,r,a,s,f+1,n+1,i))>g&&(f===l?c*=1:v.test(t.charAt(f-1))?(c*=.8,(u=t.slice(l,f-1).match(b))&&l>0&&(c*=Math.pow(.999,u.length))):y.test(t.charAt(f-1))?(c*=.9,(m=t.slice(l,f-1).match(k))&&l>0&&(c*=Math.pow(.999,m.length))):(c*=.17,l>0&&(c*=Math.pow(.999,f-l))),t.charAt(f)!==r.charAt(n)&&(c*=.9999)),(c<.1&&a.charAt(f-1)===s.charAt(n+1)||s.charAt(n+1)===s.charAt(n)&&a.charAt(f-1)!==s.charAt(n))&&.1*(o=e(t,r,a,s,f+1,n+2,i))>c&&(c=.1*o),c>g&&(g=c),f=a.indexOf(x,f+1);return i[d]=g,g}(a=r&&r.length>0?`${a+" "+r.join(" ")}`:a,t,j(a),j(t),0,0,{})},A=r.createContext(void 0),L=r.createContext(void 0),F=r.createContext(void 0),z=r.forwardRef((e,t)=>{let a=G(()=>{var t,r;return{search:"",value:null!=(r=null!=(t=e.value)?t:e.defaultValue)?r:"",selectedItemId:void 0,filtered:{count:0,items:new Map,groups:new Set}}}),s=G(()=>new Set),l=G(()=>new Map),n=G(()=>new Map),i=G(()=>new Set),d=V(e),{label:c,children:o,value:u,onValueChange:m,filter:x,shouldFilter:f,loop:g,disablePointerSelection:h=!1,vimBindings:p=!0,...v}=e,b=(0,N.useId)(),y=(0,N.useId)(),k=(0,N.useId)(),j=r.useRef(null),w=J();q(()=>{if(void 0!==u){let e=u.trim();a.current.value=e,C.emit()}},[u]),q(()=>{w(6,$)},[]);let C=r.useMemo(()=>({subscribe:e=>(i.current.add(e),()=>i.current.delete(e)),snapshot:()=>a.current,setState:(e,t,r)=>{var s,l,n,i;if(!Object.is(a.current[e],t)){if(a.current[e]=t,"search"===e)T(),O(),w(1,B);else if("value"===e){if(document.activeElement.hasAttribute("cmdk-input")||document.activeElement.hasAttribute("cmdk-root")){let e=document.getElementById(k);e?e.focus():null==(s=document.getElementById(b))||s.focus()}if(w(7,()=>{var e;a.current.selectedItemId=null==(e=U())?void 0:e.id,C.emit()}),r||w(5,$),(null==(l=d.current)?void 0:l.value)!==void 0){null==(i=(n=d.current).onValueChange)||i.call(n,null!=t?t:"");return}}C.emit()}},emit:()=>{i.current.forEach(e=>e())}}),[]),F=r.useMemo(()=>({value:(e,t,r)=>{var s;t!==(null==(s=n.current.get(e))?void 0:s.value)&&(n.current.set(e,{value:t,keywords:r}),a.current.filtered.items.set(e,z(t,r)),w(2,()=>{O(),C.emit()}))},item:(e,t)=>(s.current.add(e),t&&(l.current.has(t)?l.current.get(t).add(e):l.current.set(t,new Set([e]))),w(3,()=>{T(),O(),a.current.value||B(),C.emit()}),()=>{n.current.delete(e),s.current.delete(e),a.current.filtered.items.delete(e);let t=U();w(4,()=>{T(),(null==t?void 0:t.getAttribute("id"))===e&&B(),C.emit()})}),group:e=>(l.current.has(e)||l.current.set(e,new Set),()=>{n.current.delete(e),l.current.delete(e)}),filter:()=>d.current.shouldFilter,label:c||e["aria-label"],getDisablePointerSelection:()=>d.current.disablePointerSelection,listId:b,inputId:k,labelId:y,listInnerRef:j}),[]);function z(e,t){var r,s;let l=null!=(s=null==(r=d.current)?void 0:r.filter)?s:P;return e?l(e,a.current.search,t):0}function O(){if(!a.current.search||!1===d.current.shouldFilter)return;let e=a.current.filtered.items,t=[];a.current.filtered.groups.forEach(r=>{let a=l.current.get(r),s=0;a.forEach(t=>{s=Math.max(e.get(t),s)}),t.push([r,s])});let r=j.current;H().sort((t,r)=>{var a,s;let l=t.getAttribute("id"),n=r.getAttribute("id");return(null!=(a=e.get(n))?a:0)-(null!=(s=e.get(l))?s:0)}).forEach(e=>{let t=e.closest(R);t?t.appendChild(e.parentElement===t?e:e.closest(`${R} > *`)):r.appendChild(e.parentElement===r?e:e.closest(`${R} > *`))}),t.sort((e,t)=>t[1]-e[1]).forEach(e=>{var t;let r=null==(t=j.current)?void 0:t.querySelector(`${S}[${M}="${encodeURIComponent(e[0])}"]`);null==r||r.parentElement.appendChild(r)})}function B(){let e=H().find(e=>"true"!==e.getAttribute("aria-disabled")),t=null==e?void 0:e.getAttribute(M);C.setState("value",t||void 0)}function T(){var e,t,r,i;if(!a.current.search||!1===d.current.shouldFilter){a.current.filtered.count=s.current.size;return}a.current.filtered.groups=new Set;let c=0;for(let l of s.current){let s=z(null!=(t=null==(e=n.current.get(l))?void 0:e.value)?t:"",null!=(i=null==(r=n.current.get(l))?void 0:r.keywords)?i:[]);a.current.filtered.items.set(l,s),s>0&&c++}for(let[e,t]of l.current)for(let r of t)if(a.current.filtered.items.get(r)>0){a.current.filtered.groups.add(e);break}a.current.filtered.count=c}function $(){var e,t,r;let a=U();a&&((null==(e=a.parentElement)?void 0:e.firstChild)===a&&(null==(r=null==(t=a.closest(S))?void 0:t.querySelector('[cmdk-group-heading=""]'))||r.scrollIntoView({block:"nearest"})),a.scrollIntoView({block:"nearest"}))}function U(){var e;return null==(e=j.current)?void 0:e.querySelector(`${E}[aria-selected="true"]`)}function H(){var e;return Array.from((null==(e=j.current)?void 0:e.querySelectorAll(D))||[])}function K(e){let t=H()[e];t&&C.setState("value",t.getAttribute(M))}function W(e){var t;let r=U(),a=H(),s=a.findIndex(e=>e===r),l=a[s+e];null!=(t=d.current)&&t.loop&&(l=s+e<0?a[a.length-1]:s+e===a.length?a[0]:a[s+e]),l&&C.setState("value",l.getAttribute(M))}function X(e){let t=U(),r=null==t?void 0:t.closest(S),a;for(;r&&!a;)a=null==(r=e>0?function(e,t){let r=e.nextElementSibling;for(;r;){if(r.matches(t))return r;r=r.nextElementSibling}}(r,S):function(e,t){let r=e.previousElementSibling;for(;r;){if(r.matches(t))return r;r=r.previousElementSibling}}(r,S))?void 0:r.querySelector(D);a?C.setState("value",a.getAttribute(M)):W(e)}let Z=()=>K(H().length-1),ee=e=>{e.preventDefault(),e.metaKey?Z():e.altKey?X(1):W(1)},et=e=>{e.preventDefault(),e.metaKey?K(0):e.altKey?X(-1):W(-1)};return r.createElement(_.Primitive.div,{ref:t,tabIndex:-1,...v,"cmdk-root":"",onKeyDown:e=>{var t;null==(t=v.onKeyDown)||t.call(v,e);let r=e.nativeEvent.isComposing||229===e.keyCode;if(!(e.defaultPrevented||r))switch(e.key){case"n":case"j":p&&e.ctrlKey&&ee(e);break;case"ArrowDown":ee(e);break;case"p":case"k":p&&e.ctrlKey&&et(e);break;case"ArrowUp":et(e);break;case"Home":e.preventDefault(),K(0);break;case"End":e.preventDefault(),Z();break;case"Enter":{e.preventDefault();let t=U();if(t){let e=new Event(I);t.dispatchEvent(e)}}}}},r.createElement("label",{"cmdk-label":"",htmlFor:F.inputId,id:F.labelId,style:Y},c),Q(e,e=>r.createElement(L.Provider,{value:C},r.createElement(A.Provider,{value:F},e))))}),O=r.forwardRef((e,t)=>{var a,s;let l=(0,N.useId)(),n=r.useRef(null),i=r.useContext(F),d=r.useContext(A),c=V(e),o=null!=(s=null==(a=c.current)?void 0:a.forceMount)?s:null==i?void 0:i.forceMount;q(()=>{if(!o)return d.item(l,null==i?void 0:i.id)},[o]);let u=X(l,n,[e.value,e.children,n],e.keywords),m=r.useContext(L),x=W(e=>e.value&&e.value===u.current),f=W(e=>!!o||!1===d.filter()||!e.search||e.filtered.items.get(l)>0);function g(){var e,t;h(),null==(t=(e=c.current).onSelect)||t.call(e,u.current)}function h(){m.setState("value",u.current,!0)}if(r.useEffect(()=>{let t=n.current;if(!(!t||e.disabled))return t.addEventListener(I,g),()=>t.removeEventListener(I,g)},[f,e.onSelect,e.disabled]),!f)return null;let{disabled:p,value:v,onSelect:b,forceMount:y,keywords:k,...j}=e;return r.createElement(_.Primitive.div,{ref:(0,C.composeRefs)(n,t),...j,id:l,"cmdk-item":"",role:"option","aria-disabled":!!p,"aria-selected":!!x,"data-disabled":!!p,"data-selected":!!x,onPointerMove:p||d.getDisablePointerSelection()?void 0:h,onClick:p?void 0:g},e.children)}),B=r.forwardRef((e,t)=>{let{heading:a,children:s,forceMount:l,...n}=e,i=(0,N.useId)(),d=r.useRef(null),c=r.useRef(null),o=(0,N.useId)(),u=r.useContext(A),m=W(e=>!!l||!1===u.filter()||!e.search||e.filtered.groups.has(i));q(()=>u.group(i),[]),X(i,d,[e.value,e.heading,c]);let x=r.useMemo(()=>({id:i,forceMount:l}),[l]);return r.createElement(_.Primitive.div,{ref:(0,C.composeRefs)(d,t),...n,"cmdk-group":"",role:"presentation",hidden:!m||void 0},a&&r.createElement("div",{ref:c,"cmdk-group-heading":"","aria-hidden":!0,id:o},a),Q(e,e=>r.createElement("div",{"cmdk-group-items":"",role:"group","aria-labelledby":a?o:void 0},r.createElement(F.Provider,{value:x},e))))}),T=r.forwardRef((e,t)=>{let{alwaysRender:a,...s}=e,l=r.useRef(null),n=W(e=>!e.search);return a||n?r.createElement(_.Primitive.div,{ref:(0,C.composeRefs)(l,t),...s,"cmdk-separator":"",role:"separator"}):null}),$=r.forwardRef((e,t)=>{let{onValueChange:a,...s}=e,l=null!=e.value,n=r.useContext(L),i=W(e=>e.search),d=W(e=>e.selectedItemId),c=r.useContext(A);return r.useEffect(()=>{null!=e.value&&n.setState("search",e.value)},[e.value]),r.createElement(_.Primitive.input,{ref:t,...s,"cmdk-input":"",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"aria-autocomplete":"list",role:"combobox","aria-expanded":!0,"aria-controls":c.listId,"aria-labelledby":c.labelId,"aria-activedescendant":d,id:c.inputId,type:"text",value:l?e.value:i,onChange:e=>{l||n.setState("search",e.target.value),null==a||a(e.target.value)}})}),U=r.forwardRef((e,t)=>{let{children:a,label:s="Suggestions",...l}=e,n=r.useRef(null),i=r.useRef(null),d=W(e=>e.selectedItemId),c=r.useContext(A);return r.useEffect(()=>{if(i.current&&n.current){let e=i.current,t=n.current,r,a=new ResizeObserver(()=>{r=requestAnimationFrame(()=>{let r=e.offsetHeight;t.style.setProperty("--cmdk-list-height",r.toFixed(1)+"px")})});return a.observe(e),()=>{cancelAnimationFrame(r),a.unobserve(e)}}},[]),r.createElement(_.Primitive.div,{ref:(0,C.composeRefs)(n,t),...l,"cmdk-list":"",role:"listbox",tabIndex:-1,"aria-activedescendant":d,"aria-label":s,id:c.listId},Q(e,e=>r.createElement("div",{ref:(0,C.composeRefs)(i,c.listInnerRef),"cmdk-list-sizer":""},e)))}),H=r.forwardRef((e,t)=>{let{open:a,onOpenChange:s,overlayClassName:l,contentClassName:n,container:i,...d}=e;return r.createElement(w.Root,{open:a,onOpenChange:s},r.createElement(w.Portal,{container:i},r.createElement(w.Overlay,{"cmdk-overlay":"",className:l}),r.createElement(w.Content,{"aria-label":e.label,"cmdk-dialog":"",className:n},r.createElement(z,{ref:t,...d}))))}),K=Object.assign(z,{List:U,Item:O,Input:$,Group:B,Separator:T,Dialog:H,Empty:r.forwardRef((e,t)=>W(e=>0===e.filtered.count)?r.createElement(_.Primitive.div,{ref:t,...e,"cmdk-empty":"",role:"presentation"}):null),Loading:r.forwardRef((e,t)=>{let{progress:a,children:s,label:l="Loading...",...n}=e;return r.createElement(_.Primitive.div,{ref:t,...n,"cmdk-loading":"",role:"progressbar","aria-valuenow":a,"aria-valuemin":0,"aria-valuemax":100,"aria-label":l},Q(e,e=>r.createElement("div",{"aria-hidden":!0},e)))})});function V(e){let t=r.useRef(e);return q(()=>{t.current=e}),t}var q="undefined"==typeof window?r.useEffect:r.useLayoutEffect;function G(e){let t=r.useRef();return void 0===t.current&&(t.current=e()),t}function W(e){let t=r.useContext(L),a=()=>e(t.snapshot());return r.useSyncExternalStore(t.subscribe,a,a)}function X(e,t,a,s=[]){let l=r.useRef(),n=r.useContext(A);return q(()=>{var r;let i=(()=>{var e;for(let t of a){if("string"==typeof t)return t.trim();if("object"==typeof t&&"current"in t)return t.current?null==(e=t.current.textContent)?void 0:e.trim():l.current}})(),d=s.map(e=>e.trim());n.value(e,i,d),null==(r=t.current)||r.setAttribute(M,i),l.current=i}),l}var J=()=>{let[e,t]=r.useState(),a=G(()=>new Map);return q(()=>{a.current.forEach(e=>e()),a.current=new Map},[e]),(e,r)=>{a.current.set(e,r),t({})}};function Q({asChild:e,children:t},a){let s;return e&&r.isValidElement(t)?r.cloneElement("function"==typeof(s=t.type)?s(t.props):"render"in s?s.render(t.props):t,{ref:t.ref},a(t.props.children)):a(t)}var Y={position:"absolute",width:"1px",height:"1px",padding:"0",margin:"-1px",overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",borderWidth:"0"},Z=e.i(72226);let ee=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(K,{ref:s,className:(0,a.cn)("flex h-full w-full flex-col overflow-hidden rounded-md bg-popover text-popover-foreground",e),...r}));ee.displayName=K.displayName;let et=r.forwardRef(({className:e,...r},s)=>(0,t.jsxs)("div",{className:"flex items-center border-b px-3","cmdk-input-wrapper":"",children:[(0,t.jsx)(Z.MagnifyingGlassIcon,{className:"mr-2 h-4 w-4 shrink-0 opacity-50"}),(0,t.jsx)(K.Input,{ref:s,className:(0,a.cn)("flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-none placeholder:text-muted-foreground disabled:cursor-not-allowed disabled:opacity-50",e),...r})]}));et.displayName=K.Input.displayName;let er=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(K.List,{ref:s,className:(0,a.cn)("max-h-[300px] overflow-y-auto overflow-x-hidden",e),...r}));er.displayName=K.List.displayName;let ea=r.forwardRef((e,r)=>(0,t.jsx)(K.Empty,{ref:r,className:"py-6 text-center text-sm",...e}));ea.displayName=K.Empty.displayName;let es=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(K.Group,{ref:s,className:(0,a.cn)("overflow-hidden p-1 text-foreground [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group-heading]]:text-muted-foreground",e),...r}));es.displayName=K.Group.displayName,r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(K.Separator,{ref:s,className:(0,a.cn)("-mx-1 h-px bg-border",e),...r})).displayName=K.Separator.displayName;let el=r.forwardRef(({className:e,...r},s)=>(0,t.jsx)(K.Item,{ref:s,className:(0,a.cn)("relative flex cursor-default gap-2 select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none data-[disabled=true]:pointer-events-none data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",e),...r}));el.displayName=K.Item.displayName;var en=(0,c.createServerReference)("60211aeb80c05ed8abf26656abe964d684267a3d74",c.callServer,void 0,c.findSourceMapURL,"assignRole"),ei=e.i(61911);let ed=(0,h.default)("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function ec({role:e,profiles:a}){let[n,i]=(0,r.useState)(!1),d=e.permissions?.target==="cast"?"cast":"staff",c=a.filter(e=>e.role===d),o=c.filter(t=>t.role_id===e.id),u=c.filter(t=>t.role_id!==e.id),m=async t=>{try{await en(t,e.id)}catch(e){console.error(e),alert("エラーが発生しました")}},x=async e=>{try{await en(e,null)}catch(e){console.error(e),alert("エラーが発生しました")}};return(0,t.jsxs)(l.Dialog,{open:n,onOpenChange:i,children:[(0,t.jsx)(l.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",children:[(0,t.jsx)(ei.Users,{className:"mr-2 h-4 w-4"}),"メンバー管理 (",o.length,")"]})}),(0,t.jsxs)(l.DialogContent,{className:"bg-white dark:bg-gray-800 w-[95%] rounded-lg p-6 max-h-[90vh] overflow-y-auto sm:max-w-2xl",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsxs)(l.DialogTitle,{className:"text-slate-900 dark:text-white",children:[e.name," - メンバー管理"]}),(0,t.jsx)(l.DialogDescription,{className:"text-slate-500 dark:text-gray-400",children:"このロールを持つユーザーを管理します。"})]}),(0,t.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-gray-700 bg-slate-50/80 dark:bg-gray-900/50 p-4 sm:p-5",children:[(0,t.jsx)("h4",{className:"font-medium mb-2 text-gray-900 dark:text-white",children:"現在のメンバー"}),(0,t.jsxs)("div",{className:"space-y-2 max-h-[300px] overflow-y-auto",children:[0===o.length&&(0,t.jsx)("p",{className:"text-sm text-muted-foreground dark:text-gray-400",children:"メンバーはいません"}),o.map(e=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-2 bg-secondary/50 dark:bg-gray-800 rounded-md",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:e.display_name}),e.real_name&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:e.real_name})]}),(0,t.jsx)(s.Button,{variant:"ghost",size:"icon",className:"h-8 w-8 text-muted-foreground hover:text-destructive",onClick:()=>x(e.id),children:(0,t.jsx)(ed,{className:"h-4 w-4"})})]},e.id))]})]}),(0,t.jsxs)("div",{className:"rounded-2xl border border-slate-200 dark:border-gray-700 bg-slate-50/80 dark:bg-gray-900/50 p-4 sm:p-5",children:[(0,t.jsx)("h4",{className:"font-medium mb-2 text-gray-900 dark:text-white",children:"メンバーを追加"}),(0,t.jsxs)(ee,{className:"w-full border border-slate-200 dark:border-gray-700 rounded-xl overflow-hidden bg-white dark:bg-gray-800",children:[(0,t.jsx)(et,{placeholder:"ユーザーを検索...",className:"dark:text-white"}),(0,t.jsxs)(er,{children:[(0,t.jsx)(ea,{className:"text-gray-700 dark:text-gray-200",children:"ユーザーが見つかりません"}),(0,t.jsx)(es,{children:u.map(e=>(0,t.jsxs)(el,{onSelect:()=>m(e.id),className:"flex items-center justify-between dark:text-white",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm font-medium",children:e.display_name}),e.real_name&&(0,t.jsx)("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:e.real_name})]}),e.role_id&&(0,t.jsx)("span",{className:"text-xs text-muted-foreground bg-secondary px-2 py-0.5 rounded",children:"他のロールあり"})]},e.id))})]})]})]})]})]})]})}var eo=(0,c.createServerReference)("404e99b8a0847028f660fbc984b5dd6745e3b9c778",c.callServer,void 0,c.findSourceMapURL,"deleteRole");function eu({role:e,profiles:a}){let[n,i]=(0,r.useState)(!1),[d,c]=(0,r.useState)(!1),o=async()=>{c(!0);try{await eo(e.id),i(!1)}catch(e){console.error(e),alert("削除に失敗しました。メンバーが割り当てられている可能性があります。")}finally{c(!1)}};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"rounded-lg border border-gray-200 dark:border-gray-700 bg-card dark:bg-gray-800 text-card-foreground dark:text-white shadow-sm p-6 flex flex-col h-full",children:[(0,t.jsxs)("div",{className:"flex items-center gap-4 mb-4",children:[(0,t.jsx)("div",{className:"p-2 bg-primary/10 dark:bg-primary/20 rounded-full",children:(0,t.jsx)(f.Shield,{className:"h-6 w-6 text-primary dark:text-primary-400"})}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 dark:text-white",children:e.name}),(0,t.jsxs)("p",{className:"text-xs text-muted-foreground dark:text-gray-400",children:[new Date(e.created_at).toLocaleDateString()," 作成"]})]})]}),(0,t.jsx)("div",{className:"text-sm text-muted-foreground dark:text-gray-400 flex-1 mb-4",children:(0,t.jsxs)("ul",{className:"list-disc list-inside space-y-1",children:[e.permissions?.can_manage_roles&&(0,t.jsx)("li",{children:"権限管理"}),e.permissions?.can_manage_users&&(0,t.jsx)("li",{children:"プロフィール情報"}),e.permissions?.can_manage_settings&&(0,t.jsx)("li",{children:"店舗設定"}),e.permissions?.can_use_timecard&&(0,t.jsx)("li",{children:"タイムカード"}),e.permissions?.can_manage_attendance&&(0,t.jsx)("li",{children:"勤怠"}),e.permissions?.can_view_dashboard&&(0,t.jsx)("li",{children:"ダッシュボード"}),!Object.values(e.permissions||{}).some(Boolean)&&(0,t.jsx)("li",{children:"権限なし"})]})}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 mt-auto pt-4 border-t",children:[(0,t.jsx)(ec,{role:e,profiles:a}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",className:"flex-1 text-destructive hover:text-destructive",onClick:()=>i(!0),disabled:e.is_system_role,children:[(0,t.jsx)(g.Trash2,{className:"mr-2 h-4 w-4"}),"削除"]}),(0,t.jsx)(x,{role:e,trigger:(0,t.jsxs)(s.Button,{variant:"outline",size:"sm",className:"flex-1",disabled:e.is_system_role,children:[(0,t.jsx)(p,{className:"mr-2 h-4 w-4"}),"編集"]})})]})]})]}),(0,t.jsx)(l.Dialog,{open:n,onOpenChange:i,children:(0,t.jsxs)(l.DialogContent,{className:"sm:max-w-[425px] bg-white dark:bg-gray-800 w-[95%] rounded-lg p-6",children:[(0,t.jsxs)(l.DialogHeader,{children:[(0,t.jsx)(l.DialogTitle,{children:"ロールを削除"}),(0,t.jsxs)(l.DialogDescription,{className:"text-gray-500 dark:text-gray-400",children:["「",e.name,"」を削除しますか？",(0,t.jsx)("br",{}),(0,t.jsx)("span",{className:"text-destructive font-semibold",children:"※この操作は取り消せません。"})]})]}),(0,t.jsxs)(l.DialogFooter,{className:"flex flex-col gap-4",children:[(0,t.jsx)(s.Button,{variant:"destructive",onClick:o,disabled:d,className:"w-full",children:d?"削除中...":"削除する"}),(0,t.jsx)(s.Button,{variant:"outline",onClick:()=>i(!1),disabled:d,className:"w-full",children:"キャンセル"})]})]})})]})}function em({roles:e,profiles:l}){let[n,i]=(0,r.useState)("staff"),d=r.default.useRef(null),c=e.filter(e=>(e.permissions?.target==="cast"?"cast":"staff")===n);return(0,t.jsxs)("div",{className:"relative min-h-screen pb-20",children:[(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-xl md:text-2xl font-bold text-gray-900 dark:text-white",children:"権限管理"}),(0,t.jsx)("p",{className:"mt-1 text-xs md:text-sm text-gray-500 dark:text-gray-400",children:"店舗の役割と権限を設定します。"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,t.jsxs)("div",{className:"inline-flex items-center rounded-full bg-gray-100 dark:bg-gray-800 p-1",children:[(0,t.jsx)("button",{type:"button",onClick:()=>i("cast"),className:(0,a.cn)("px-4 py-2 rounded-full text-sm font-medium transition-colors","cast"===n?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400"),children:"キャスト"}),(0,t.jsx)("button",{type:"button",onClick:()=>i("staff"),className:(0,a.cn)("px-4 py-2 rounded-full text-sm font-medium transition-colors","staff"===n?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-600 dark:text-gray-400"),children:"スタッフ"})]}),(0,t.jsx)(s.Button,{size:"icon",className:"h-10 w-10 rounded-full bg-white hover:bg-gray-50 border-2 border-blue-500 text-blue-500",onClick:()=>d.current?.click(),children:(0,t.jsx)(m.Plus,{className:"h-5 w-5"})})]}),(0,t.jsx)("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:c.map(e=>(0,t.jsx)(eu,{role:e,profiles:l},e.id))})]}),(0,t.jsx)(x,{target:n,trigger:(0,t.jsx)("button",{ref:d,className:"hidden"})})]})}e.s(["RolesPageClient",()=>em],47151)}]);