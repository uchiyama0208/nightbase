module.exports=[18622,(a,b,c)=>{b.exports=a.x("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js",()=>require("next/dist/compiled/next-server/app-page-turbo.runtime.prod.js"))},56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},87924,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactJsxRuntime},42602,(a,b,c)=>{"use strict";b.exports=a.r(18622)},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},5050,(a,b,c)=>{"use strict";Object.defineProperty(c,"__esModule",{value:!0});var d={callServer:function(){return f.callServer},createServerReference:function(){return h.createServerReference},findSourceMapURL:function(){return g.findSourceMapURL}};for(var e in d)Object.defineProperty(c,e,{enumerable:!0,get:d[e]});let f=a.r(20611),g=a.r(1722),h=a.r(38783)},3688,a=>{"use strict";var b=a.i(72131),c=a.i(72752);function d(a){let[d,e]=b.useState(void 0);return(0,c.useLayoutEffect)(()=>{if(a){e({width:a.offsetWidth,height:a.offsetHeight});let b=new ResizeObserver(b=>{let c,d;if(!Array.isArray(b)||!b.length)return;let f=b[0];if("borderBoxSize"in f){let a=f.borderBoxSize,b=Array.isArray(a)?a[0]:a;c=b.inlineSize,d=b.blockSize}else c=a.offsetWidth,d=a.offsetHeight;e({width:c,height:d})});return b.observe(a,{box:"border-box"}),()=>b.unobserve(a)}e(void 0)},[a]),d}a.s(["useSize",()=>d])},77994,a=>{"use strict";var b=a.i(72131);function c(a){let c=b.useRef({value:a,previous:a});return b.useMemo(()=>(c.current.value!==a&&(c.current.previous=c.current.value,c.current.value=a),c.current.previous),[a])}a.s(["usePrevious",()=>c])},11587,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97942),e=a.i(55294);let f=d.Root,g=d.Trigger,h=d.Portal,i=d.Close,j=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Overlay,{ref:f,className:(0,e.cn)("fixed inset-0 z-50 bg-slate-950/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out",a),...c}));j.displayName=d.Overlay.displayName;let k=c.forwardRef(({className:a,children:c,...f},g)=>(0,b.jsxs)(h,{children:[(0,b.jsx)(j,{}),(0,b.jsx)(d.Content,{ref:g,className:(0,e.cn)("fixed left-1/2 top-1/2 z-50 w-[calc(100%-2rem)] max-w-xl -translate-x-1/2 -translate-y-1/2 rounded-3xl border border-slate-200 bg-white p-8 text-slate-900 shadow-2xl backdrop-blur data-[state=open]:animate-in data-[state=closed]:animate-out dark:border-white/10 dark:bg-slate-950/95 dark:text-slate-100",a),...f,children:c})]}));k.displayName=d.Content.displayName;let l=({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("mb-6 flex flex-col gap-2 text-center sm:text-left",a),...c});l.displayName="DialogHeader";let m=({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...c});m.displayName="DialogFooter";let n=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Title,{ref:f,className:(0,e.cn)("text-xl font-semibold text-slate-900 dark:text-slate-50",a),...c}));n.displayName=d.Title.displayName;let o=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Description,{ref:f,className:(0,e.cn)("text-sm text-slate-500 dark:text-slate-400",a),...c}));o.displayName=d.Description.displayName,a.s(["Dialog",()=>f,"DialogClose",()=>i,"DialogContent",()=>k,"DialogDescription",()=>o,"DialogFooter",()=>m,"DialogHeader",()=>l,"DialogTitle",()=>n,"DialogTrigger",()=>g])},87355,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(55294);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("rounded-3xl border border-white/10 bg-white/5 p-6 shadow-[0_20px_60px_-20px_rgba(15,23,42,0.45)] backdrop-blur",a),...c}));e.displayName="Card";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("mb-6 flex flex-col gap-2",a),...c}));f.displayName="CardHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("h3",{ref:e,className:(0,d.cn)("text-lg font-semibold text-slate-50",a),...c}));g.displayName="CardTitle";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("p",{ref:e,className:(0,d.cn)("text-sm text-slate-300",a),...c}));h.displayName="CardDescription";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("text-slate-100",a),...c}));i.displayName="CardContent";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{ref:e,className:(0,d.cn)("mt-6 flex items-center justify-between",a),...c}));j.displayName="CardFooter",a.s(["Card",()=>e,"CardContent",()=>i,"CardDescription",()=>h,"CardFooter",()=>j,"CardHeader",()=>f,"CardTitle",()=>g])},77156,a=>{"use strict";var b=a.i(77859);a.s(["Eye",()=>b.default])},77859,a=>{"use strict";let b=(0,a.i(70106).default)("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["default",()=>b])},13648,a=>{"use strict";let b=(0,a.i(70106).default)("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);a.s(["default",()=>b])},41379,a=>{"use strict";var b=a.i(13648);a.s(["EyeOff",()=>b.default])},71716,a=>{"use strict";var b=a.i(5050),c=(0,b.createServerReference)("40d281ed84b38ac668808ba72195ebb5e55f757c52",b.callServer,void 0,b.findSourceMapURL,"acceptInvitation");a.s(["acceptInvitation",()=>c])},129,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(45750),e=a.i(92772),f=a.i(2783),g=a.i(87355),h=a.i(56711),i=a.i(2411),j=a.i(55054),k=a.i(38246),l=a.i(77156),m=a.i(41379),n=a.i(11587),o=a.i(71716),p=a.i(50944);function q({invitation:a,userId:q}){let[r,s]=(0,c.useState)("line"),[t,u]=(0,c.useState)(""),[v,w]=(0,c.useState)(""),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(""),[B,C]=(0,c.useState)(!1),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)(""),[H,I]=(0,c.useState)(!1),[J,K]=(0,c.useState)(!1),[L,M]=(0,c.useState)(!1),[N,O]=(0,c.useState)(!1),[P,Q]=(0,c.useState)(""),[R,S]=(0,c.useState)(!1),T=(0,p.useRouter)();(0,c.useEffect)(()=>{(async()=>{if(q&&!R&&!N){console.log("Auto-accepting invitation for logged-in user"),S(!0);try{let b=await (0,o.acceptInvitation)(a.token);b.success?T.push("/app/dashboard"):(console.error("Failed to auto-accept invitation:",b.error),S(!1))}catch(a){console.error("Error auto-accepting invitation:",a),S(!1)}}})()},[q,a.token,R,N,T]);let U=async()=>{I(!0);try{let b=process.env.NEXT_PUBLIC_SUPABASE_URL;if(!b){alert("設定エラー: Supabase URLが見つかりません"),I(!1);return}let c=`${b}/functions/v1/line-auth?mode=join-store&invite_token=${a.token}`;window.location.href=c}catch(a){console.error("Unexpected error:",a),alert("エラーが発生しました"),I(!1)}},V=async()=>{if((G(""),v&&x&&z)?x.length<6?(G("パスワードは6文字以上で入力してください"),!1):x!==z?(G("パスワードが一致しません"),!1):!a.has_password||!!t||(G("招待パスワードを入力してください"),!1):(G("すべての項目を入力してください"),!1)){I(!0),G("");try{let b=await fetch("/api/auth/signup-with-invite",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:v,password:x,inviteToken:a.token,invitePassword:t})}),c=await b.json();if(!c.success){G(c.message||"登録に失敗しました"),I(!1);return}Q(c.message||"確認メールを送信しました。メールをご確認ください。"),O(!0),I(!1)}catch(a){console.error("Signup error:",a),G("予期しないエラーが発生しました"),I(!1)}}},W=J&&L;return R?(0,b.jsx)("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:(0,b.jsxs)("div",{className:"text-center space-y-4",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-white mx-auto"}),(0,b.jsx)("p",{className:"text-gray-600 dark:text-gray-400",children:"招待を受諾しています..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen flex flex-col items-center justify-start pt-6 sm:justify-center sm:pt-0 bg-gray-50 dark:bg-gray-900 p-4",children:[(0,b.jsx)(n.Dialog,{open:N,onOpenChange:O,children:(0,b.jsxs)(n.DialogContent,{className:"sm:max-w-md",children:[(0,b.jsxs)(n.DialogHeader,{children:[(0,b.jsx)(n.DialogTitle,{className:"text-center text-xl",children:"メール送信完了"}),(0,b.jsx)(n.DialogDescription,{className:"text-center pt-2",children:P})]}),(0,b.jsx)("div",{className:"py-4",children:(0,b.jsxs)("p",{className:"text-sm text-center leading-relaxed text-muted-foreground",children:["メールに記載されているリンクをクリックして、アカウントを有効化してください。",(0,b.jsx)("br",{}),"有効化後、自動的にこの招待を受諾し、ダッシュボードにリダイレクトされます。"]})}),(0,b.jsx)(n.DialogFooter,{className:"sm:justify-center",children:(0,b.jsx)(d.Button,{onClick:()=>O(!1),className:"w-full sm:w-auto min-w-[120px] bg-blue-600 hover:bg-blue-700 text-white",children:"閉じる"})})]})}),(0,b.jsxs)(g.Card,{className:"w-full max-w-md shadow-none sm:shadow-sm border-0 sm:border bg-transparent sm:bg-card",children:[(0,b.jsxs)(g.CardHeader,{className:"text-center space-y-1 pt-0 pb-2 sm:pt-6",children:[(0,b.jsx)("div",{className:"mx-auto w-12 h-12 bg-[#06C755]/10 rounded-full flex items-center justify-center mb-1",children:(0,b.jsx)("svg",{className:"w-6 h-6 text-[#06C755]",fill:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,b.jsx)("path",{d:"M12 2.5C6.6 2.5 2.5 6.2 2.5 10.8c0 2.6 1.3 4.9 3.4 6.4 0.3 0.2 0.4 0.5 0.3 0.8 -0.1 0.9 -0.4 3.2 -0.4 3.4 0 0.3 0.2 0.5 0.5 0.5 0.2 0 2.6 -0.5 5.4 -1.9 0.1 -0.1 0.3 -0.1 0.4 -0.1 0.1 0 0.2 0 0.3 0 5.4 0 9.5 -3.7 9.5 -8.3C21.5 6.2 17.4 2.5 12 2.5z"})})}),(0,b.jsx)(g.CardTitle,{className:"text-xl sm:text-2xl font-bold text-gray-900 dark:text-white",children:"店舗への招待"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"以下の店舗から招待が届いています"})]}),(0,b.jsxs)(g.CardContent,{className:"space-y-6 px-0 sm:px-6",children:[(0,b.jsxs)("div",{className:"space-y-4 bg-white dark:bg-gray-800 p-4 rounded-lg border shadow-sm",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"店舗名"}),(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:a.store_name})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"名前"}),(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:a.profile_name})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("span",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"有効期限"}),(0,b.jsx)("span",{className:"font-medium text-gray-900 dark:text-white",children:(0,h.format)(new Date(a.expires_at),"yyyy/MM/dd HH:mm",{locale:i.ja})})]})]}),(0,b.jsxs)("div",{className:"flex gap-2 p-1 bg-gray-100 dark:bg-gray-800 rounded-lg",children:[(0,b.jsx)("button",{onClick:()=>s("line"),className:`flex-1 py-1.5 px-3 text-sm rounded-md transition-colors whitespace-nowrap ${"line"===r?"bg-white dark:bg-gray-700 shadow-sm font-medium text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:"LINEで参加"}),(0,b.jsx)("button",{onClick:()=>s("email"),className:`flex-1 py-1.5 px-3 text-sm rounded-md transition-colors whitespace-nowrap ${"email"===r?"bg-white dark:bg-gray-700 shadow-sm font-medium text-gray-900 dark:text-white":"text-gray-600 dark:text-gray-400"}`,children:"メールアドレスで参加"})]}),"email"===r&&(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.Label,{htmlFor:"email",className:"text-gray-900 dark:text-white",children:["メールアドレス ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsx)(e.Input,{id:"email",type:"email",value:v,onChange:a=>w(a.target.value),placeholder:"example@email.com",className:"mt-1"})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.Label,{htmlFor:"signup-password",className:"text-gray-900 dark:text-white",children:["パスワード ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("div",{className:"relative mt-1",children:[(0,b.jsx)(e.Input,{id:"signup-password",type:B?"text":"password",value:x,onChange:a=>y(a.target.value),placeholder:"6文字以上",className:"pr-10"}),(0,b.jsx)("button",{type:"button",onClick:()=>C(!B),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:B?(0,b.jsx)(m.EyeOff,{size:20}):(0,b.jsx)(l.Eye,{size:20})})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsxs)(f.Label,{htmlFor:"confirm-password",className:"text-gray-900 dark:text-white",children:["パスワード（確認） ",(0,b.jsx)("span",{className:"text-red-500",children:"*"})]}),(0,b.jsxs)("div",{className:"relative mt-1",children:[(0,b.jsx)(e.Input,{id:"confirm-password",type:D?"text":"password",value:z,onChange:a=>A(a.target.value),placeholder:"パスワードを再入力",className:"pr-10"}),(0,b.jsx)("button",{type:"button",onClick:()=>E(!D),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200",children:D?(0,b.jsx)(m.EyeOff,{size:20}):(0,b.jsx)(l.Eye,{size:20})})]})]}),F&&(0,b.jsx)("p",{className:"text-sm text-red-600 bg-red-50 dark:bg-red-900/20 p-2 rounded",children:F})]}),a.has_password&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(f.Label,{htmlFor:"invite-password",children:"招待パスワード"}),(0,b.jsx)(e.Input,{id:"invite-password",type:"password",placeholder:"パスワードを入力してください",value:t,onChange:a=>u(a.target.value)}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"※この招待にはパスワードが設定されています"})]}),(0,b.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,b.jsxs)("label",{htmlFor:"terms",className:"flex items-start space-x-3 cursor-pointer",children:[(0,b.jsx)(j.Checkbox,{id:"terms",checked:J,onCheckedChange:a=>K(a)}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:"利用規約に同意する"}),(0,b.jsx)("p",{className:"text-xs",children:(0,b.jsx)(k.default,{href:"/terms-of-service",target:"_blank",className:"text-blue-600 dark:text-blue-400 underline hover:text-blue-700 dark:hover:text-blue-300",onClick:a=>a.stopPropagation(),children:"利用規約を確認する"})})]})]}),(0,b.jsxs)("label",{htmlFor:"privacy",className:"flex items-start space-x-3 cursor-pointer",children:[(0,b.jsx)(j.Checkbox,{id:"privacy",checked:L,onCheckedChange:a=>M(a)}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)("div",{className:"font-medium text-sm text-gray-900 dark:text-white",children:"プライバシーポリシーに同意する"}),(0,b.jsx)("p",{className:"text-xs",children:(0,b.jsx)(k.default,{href:"/privacy-policy",target:"_blank",className:"text-blue-600 dark:text-blue-400 underline hover:text-blue-700 dark:hover:text-blue-300",onClick:a=>a.stopPropagation(),children:"プライバシーポリシーを確認する"})})]})]})]})]}),(0,b.jsx)(g.CardFooter,{children:"line"===r?(0,b.jsx)(d.Button,{className:"w-full bg-[#06C755] hover:bg-[#05b54b] text-white font-bold",size:"lg",onClick:U,disabled:a.has_password&&!t||!W||H,children:H?"処理中...":"LINEで参加する"}):(0,b.jsxs)("div",{className:"w-full space-y-2",children:[(0,b.jsx)(d.Button,{className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-bold",size:"lg",onClick:V,disabled:!W||H,children:H?"処理中...":"メールアドレスで新規登録"}),!W&&(0,b.jsx)("p",{className:"text-sm text-gray-600 dark:text-gray-400 text-center",children:"両方の項目にチェックを入れてください"})]})})]})]})}a.s(["InviteClient",()=>q])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__fbb00303._.js.map