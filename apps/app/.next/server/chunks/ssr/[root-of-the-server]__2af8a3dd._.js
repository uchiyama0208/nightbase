module.exports=[56704,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-async-storage.external.js",()=>require("next/dist/server/app-render/work-async-storage.external.js"))},32319,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/work-unit-async-storage.external.js",()=>require("next/dist/server/app-render/work-unit-async-storage.external.js"))},20635,(a,b,c)=>{b.exports=a.x("next/dist/server/app-render/action-async-storage.external.js",()=>require("next/dist/server/app-render/action-async-storage.external.js"))},36313,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.HooksClientContext},18341,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.ServerInsertedHtml},9270,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored.contexts.AppRouterContext},72131,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].React},38783,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactServerDOMTurbopackClient},35112,(a,b,c)=>{"use strict";b.exports=a.r(42602).vendored["react-ssr"].ReactDOM},27534,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(55294);let e=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("div",{className:"relative w-full overflow-x-auto",children:(0,b.jsx)("table",{ref:e,className:(0,d.cn)("w-full caption-bottom text-left text-sm text-slate-900",a),...c})}));e.displayName="Table";let f=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("thead",{ref:e,className:(0,d.cn)("text-xs uppercase tracking-[0.25em] text-slate-500",a),...c}));f.displayName="TableHeader";let g=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tbody",{ref:e,className:(0,d.cn)("divide-y divide-slate-100",a),...c}));g.displayName="TableBody";let h=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tr",{ref:e,className:(0,d.cn)("border-b border-slate-200 transition hover:bg-slate-50",a),...c}));h.displayName="TableRow";let i=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("th",{ref:e,className:(0,d.cn)("py-3 text-xs font-semibold text-slate-500",a),...c}));i.displayName="TableHead";let j=c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("td",{ref:e,className:(0,d.cn)("py-4 text-sm text-slate-900",a),...c}));j.displayName="TableCell",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("caption",{ref:e,className:(0,d.cn)("mt-4 text-xs text-slate-500",a),...c})).displayName="TableCaption",c.forwardRef(({className:a,...c},e)=>(0,b.jsx)("tfoot",{ref:e,className:(0,d.cn)("bg-slate-50",a),...c})).displayName="TableFooter",a.s(["Table",()=>e,"TableBody",()=>g,"TableCell",()=>j,"TableHead",()=>i,"TableHeader",()=>f,"TableRow",()=>h])},11587,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97942),e=a.i(55294);let f=d.Root,g=d.Trigger,h=d.Portal,i=d.Close,j=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Overlay,{ref:f,className:(0,e.cn)("fixed inset-0 z-50 bg-slate-950/80 backdrop-blur-sm data-[state=open]:animate-in data-[state=closed]:animate-out",a),...c}));j.displayName=d.Overlay.displayName;let k=c.forwardRef(({className:a,children:c,...f},g)=>(0,b.jsxs)(h,{children:[(0,b.jsx)(j,{}),(0,b.jsx)(d.Content,{ref:g,className:(0,e.cn)("fixed left-1/2 top-1/2 z-50 w-[calc(100%-2rem)] max-w-xl -translate-x-1/2 -translate-y-1/2 rounded-3xl border border-slate-200 bg-white p-8 text-slate-900 shadow-2xl backdrop-blur data-[state=open]:animate-in data-[state=closed]:animate-out dark:border-white/10 dark:bg-slate-950/95 dark:text-slate-100",a),...f,children:c})]}));k.displayName=d.Content.displayName;let l=({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("mb-6 flex flex-col gap-2 text-center sm:text-left",a),...c});l.displayName="DialogHeader";let m=({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",a),...c});m.displayName="DialogFooter";let n=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Title,{ref:f,className:(0,e.cn)("text-xl font-semibold text-slate-900 dark:text-slate-50",a),...c}));n.displayName=d.Title.displayName;let o=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Description,{ref:f,className:(0,e.cn)("text-sm text-slate-500 dark:text-slate-400",a),...c}));o.displayName=d.Description.displayName,a.s(["Dialog",()=>f,"DialogClose",()=>i,"DialogContent",()=>k,"DialogDescription",()=>o,"DialogFooter",()=>m,"DialogHeader",()=>l,"DialogTitle",()=>n,"DialogTrigger",()=>g])},60246,a=>{"use strict";let b=(0,a.i(70106).default)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);a.s(["Users",()=>b],60246)},72692,a=>{"use strict";let b=(0,a.i(70106).default)("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);a.s(["Menu",()=>b],72692)},57355,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(97942),e=a.i(55294);let f=d.Root,g=d.Trigger,h=d.Portal;d.Close;let i=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Overlay,{ref:f,className:(0,e.cn)("fixed inset-0 z-50 bg-slate-950/70 backdrop-blur data-[state=open]:animate-in data-[state=closed]:animate-out",a),...c}));i.displayName=d.Overlay.displayName;let j=c.forwardRef(({side:a="right",className:c,children:f,...g},j)=>(0,b.jsxs)(h,{children:[(0,b.jsx)(i,{}),(0,b.jsx)(d.Content,{ref:j,className:(0,e.cn)("fixed z-50 flex h-full w-full max-w-md flex-col bg-slate-950/95 p-6 text-slate-100 shadow-2xl backdrop-blur data-[state=open]:animate-in data-[state=closed]:animate-out","right"===a&&"right-0 top-0 data-[state=closed]:slide-out-to-right data-[state=open]:slide-in-from-right","left"===a&&"left-0 top-0 data-[state=closed]:slide-out-to-left data-[state=open]:slide-in-from-left","bottom"===a&&"bottom-0 left-1/2 -translate-x-1/2 data-[state=closed]:slide-out-to-bottom data-[state=open]:slide-in-from-bottom","top"===a&&"top-0 left-1/2 -translate-x-1/2 data-[state=closed]:slide-out-to-top data-[state=open]:slide-in-from-top",c),...g,children:f})]}));j.displayName=d.Content.displayName;let k=({className:a,...c})=>(0,b.jsx)("div",{className:(0,e.cn)("mb-6 flex flex-col gap-2",a),...c});k.displayName="SheetHeader";let l=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Title,{ref:f,className:(0,e.cn)("text-lg font-semibold text-slate-50",a),...c}));l.displayName=d.Title.displayName;let m=c.forwardRef(({className:a,...c},f)=>(0,b.jsx)(d.Description,{ref:f,className:(0,e.cn)("text-sm text-slate-400",a),...c}));m.displayName=d.Description.displayName,a.s(["Sheet",()=>f,"SheetContent",()=>j,"SheetDescription",()=>m,"SheetHeader",()=>k,"SheetTitle",()=>l,"SheetTrigger",()=>g])},30617,21161,a=>{"use strict";var b=a.i(70106);let c=(0,b.default)("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);a.s(["LayoutDashboard",()=>c],30617);let d=(0,b.default)("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);a.s(["Settings",()=>d],21161)},11520,a=>{"use strict";var b=a.i(87924),c=a.i(187),d=a.i(55294);let e=(0,c.cva)("inline-flex items-center rounded-full border px-3 py-1 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-white focus:ring-primary",secondary:"border-transparent bg-secondary text-[#111111] focus:ring-secondary",outline:"border-neutral-700/20 bg-transparent text-neutral-200 focus:ring-neutral-500",neutral:"border-transparent bg-neutral-100 text-neutral-600 focus:ring-neutral-300",success:"border-transparent bg-emerald-500/15 text-emerald-500 focus:ring-emerald-400",warning:"border-transparent bg-amber-500/15 text-amber-500 focus:ring-amber-400",destructive:"border-transparent bg-red-500/15 text-red-500 focus:ring-red-400"}},defaultVariants:{variant:"default"}});function f({className:a,variant:c,...f}){return(0,b.jsx)("div",{className:(0,d.cn)(e({variant:c}),a),...f})}a.s(["Badge",()=>f])},24471,a=>{"use strict";var b=a.i(72131);let c=new Map,d=a=>{if(c.has(a))return;let b=setTimeout(()=>{c.delete(a),g({type:"REMOVE_TOAST",toastId:a})},1e6);c.set(a,b)},e=[],f={toasts:[]};function g(a){f=((a,b)=>{switch(b.type){case"ADD_TOAST":return{...a,toasts:[b.toast,...a.toasts].slice(0,5)};case"UPDATE_TOAST":return{...a,toasts:a.toasts.map(a=>a.id===b.toast.id?{...a,...b.toast}:a)};case"DISMISS_TOAST":let c=b.toastId;return c?d(c):a.toasts.forEach(a=>{d(a.id)}),{...a,toasts:a.toasts.filter(a=>a.id!==c)};case"REMOVE_TOAST":if(void 0===b.toastId)return{...a,toasts:[]};return{...a,toasts:a.toasts.filter(a=>a.id!==b.toastId)};default:return a}})(f,a),e.forEach(a=>{a(f)})}function h(){let[a,c]=b.useState(f);return b.useEffect(()=>(e.push(c),()=>{let a=e.indexOf(c);a>-1&&e.splice(a,1)}),[]),{...a,toast:({...a})=>{let b=Math.random().toString(36).slice(2,9),c=()=>g({type:"DISMISS_TOAST",toastId:b});return g({type:"ADD_TOAST",toast:{id:b,...a}}),setTimeout(c,2e3),{id:b,dismiss:c,update:a=>g({type:"UPDATE_TOAST",toast:a})}},dismiss:a=>g({type:"DISMISS_TOAST",toastId:a})}}a.s(["useToast",()=>h])},34183,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(93136),e=a.i(11520),f=a.i(45750),g=a.i(11587),h=a.i(92772),i=a.i(2783),j=a.i(27534),k=a.i(24471),l=a.i(55294);let m=[{value:"all",label:"すべて"},{value:"admin",label:"管理者"},{value:"editor",label:"編集"},{value:"viewer",label:"閲覧"}];function n({supabase:a}){let{toast:d}=(0,k.useToast)(),[g,i]=(0,c.useState)({loading:!0,error:null,users:[]}),[n,p]=(0,c.useState)(""),[q,r]=(0,c.useState)("all"),[s,t]=(0,c.useState)(null),u=(0,c.useCallback)(async()=>{i(a=>({...a,loading:!0,error:null}));let{data:b,error:c}=await a.from("profiles").select("id, display_name, email, role, updated_at, created_at").order("created_at",{ascending:!1});if(c){console.error("[AdminUsers] ユーザー取得エラー",c),i({loading:!1,error:"ユーザーの取得に失敗しました",users:[]});return}i({loading:!1,error:null,users:b??[]})},[a]);(0,c.useEffect)(()=>{u()},[u]);let v=(0,c.useMemo)(()=>{let a=n.trim().toLowerCase();return g.users.filter(b=>{let c=!a||`${b.display_name??""} ${b.email??""}`.toLowerCase().includes(a),d="all"===q||b.role===q;return c&&d})},[q,n,g.users]);async function w(b,c){t(b);let{error:e}=await a.from("profiles").update({role:c}).eq("id",b);if(e){console.error("[AdminUsers] ロール変更エラー",e),d({title:"ロールの更新に失敗しました",description:e.message}),t(null);return}i(a=>({...a,users:a.users.map(a=>a.id===b?{...a,role:c}:a)})),d({title:"ロールを更新しました"}),t(null)}return(0,b.jsxs)("div",{className:"space-y-10 p-8",children:[(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)("p",{className:"text-xs uppercase tracking-[0.3em] text-slate-500",children:"ユーザー"}),(0,b.jsx)("h1",{className:"text-4xl font-semibold text-slate-900",children:"ユーザー管理"}),(0,b.jsx)("p",{className:"text-sm text-slate-500",children:"Supabase の profiles テーブルと連携し、管理画面にアクセスできるユーザーを管理します。"})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-4 rounded-3xl border border-slate-200 bg-white p-6 md:flex-row md:items-center md:justify-between",children:[(0,b.jsx)(h.Input,{value:n,onChange:a=>p(a.target.value),placeholder:"名前やメールアドレスで検索",className:"w-full border border-slate-300 bg-white text-slate-900 placeholder:text-slate-400 md:w-80"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[m.map(a=>(0,b.jsx)(f.Button,{type:"button",variant:q===a.value?"default":"outline",className:(0,l.cn)("text-sm",q===a.value?"bg-slate-900 text-white":"border-slate-300 text-slate-700 hover:bg-slate-50 hover:text-slate-900"),onClick:()=>r(a.value),children:a.label},a.value)),(0,b.jsx)(o,{onInvited:u})]})]}),g.loading?(0,b.jsx)("div",{className:"rounded-3xl border border-slate-200 bg-white p-8 text-center text-slate-600",children:"ユーザーを読み込んでいます…"}):g.error?(0,b.jsxs)("div",{className:"space-y-4 rounded-3xl border border-red-500/40 bg-red-500/10 p-8 text-center text-red-900",children:[(0,b.jsx)("p",{children:g.error}),(0,b.jsx)(f.Button,{variant:"outline",className:"border-red-300 text-red-900",onClick:u,children:"再読み込み"})]}):(0,b.jsx)("div",{className:"overflow-x-auto rounded-3xl border border-slate-200 bg-white",children:(0,b.jsxs)(j.Table,{children:[(0,b.jsx)(j.TableHeader,{children:(0,b.jsxs)(j.TableRow,{className:"border-b border-slate-200 bg-slate-50 text-xs uppercase tracking-[0.25em] text-slate-500",children:[(0,b.jsx)(j.TableHead,{className:"px-6",children:"名前"}),(0,b.jsx)(j.TableHead,{children:"メールアドレス"}),(0,b.jsx)(j.TableHead,{children:"ロール"}),(0,b.jsx)(j.TableHead,{children:"最終更新"}),(0,b.jsx)(j.TableHead,{className:"text-right",children:"操作"})]})}),(0,b.jsx)(j.TableBody,{children:0===v.length?(0,b.jsx)(j.TableRow,{children:(0,b.jsx)(j.TableCell,{colSpan:5,className:"py-10 text-center text-sm text-slate-500",children:"条件に一致するユーザーがいません。"})}):v.map(a=>(0,b.jsxs)(j.TableRow,{className:"border-b border-slate-100",children:[(0,b.jsx)(j.TableCell,{className:"px-6 text-sm text-slate-900",children:a.display_name??"未設定"}),(0,b.jsx)(j.TableCell,{className:"text-sm text-slate-600",children:a.email??"-"}),(0,b.jsx)(j.TableCell,{children:(0,b.jsx)(e.Badge,{className:"bg-slate-100 text-slate-800",children:"admin"===a.role?"管理者":"editor"===a.role?"編集":"閲覧"})}),(0,b.jsx)(j.TableCell,{className:"text-sm text-slate-600",children:(0,l.formatDateTime)(a.updated_at)}),(0,b.jsx)(j.TableCell,{className:"text-right",children:(0,b.jsxs)("label",{className:"inline-flex items-center gap-2 text-sm text-slate-500",children:[(0,b.jsx)("span",{children:"ロール変更"}),(0,b.jsxs)("select",{className:"rounded-xl border border-slate-300 bg-white px-3 py-1 text-sm text-slate-900",value:a.role,onChange:b=>w(a.id,b.target.value),disabled:s===a.id,children:[(0,b.jsx)("option",{value:"admin",children:"管理者"}),(0,b.jsx)("option",{value:"editor",children:"編集"}),(0,b.jsx)("option",{value:"viewer",children:"閲覧"})]})]})})]},a.id))})]})})]})}function o({onInvited:a}){let{toast:d}=(0,k.useToast)(),[e,j]=(0,c.useState)(!1),[l,m]=(0,c.useState)(""),[n,o]=(0,c.useState)(""),[p,q]=(0,c.useState)("viewer"),[r,s]=(0,c.useState)(!1);async function t(b){if(b.preventDefault(),!l.trim()||!p)return void d({title:"入力内容を確認してください",description:"メールアドレスとロールは必須です"});s(!0);try{let b=await fetch("/api/admin/invite-user",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l,displayName:n,role:p})}),c=await b.json().catch(()=>({success:!1,message:"招待に失敗しました"}));if(!b.ok||!c?.success)throw console.error("[AdminUsers] 招待APIレスポンスエラー",c),Error(c?.message||c?.error||"招待に失敗しました");d({title:"ユーザーを招待しました"}),j(!1),m(""),o(""),q("viewer"),await a()}catch(a){console.error("[AdminUsers] 招待エラー",a),d({title:"招待に失敗しました",description:a instanceof Error?a.message:void 0})}finally{s(!1)}}return(0,b.jsxs)(g.Dialog,{open:e,onOpenChange:j,children:[(0,b.jsx)(g.DialogTrigger,{asChild:!0,children:(0,b.jsx)(f.Button,{type:"button",variant:"outline",className:"border-slate-300 bg-white text-slate-700 hover:bg-slate-50",children:"ユーザー招待"})}),(0,b.jsxs)(g.DialogContent,{className:"border border-slate-200 bg-white text-slate-900",children:[(0,b.jsxs)(g.DialogHeader,{children:[(0,b.jsx)(g.DialogTitle,{children:"ユーザーをメールで招待"}),(0,b.jsx)(g.DialogDescription,{className:"text-slate-500",children:"入力したメールアドレスに招待メールを送信します。ユーザーは自身でパスワードを設定できます。"})]}),(0,b.jsxs)("form",{onSubmit:t,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"invite-email",className:"text-sm text-slate-700",children:"メールアドレス"}),(0,b.jsx)(h.Input,{id:"invite-email",type:"email",required:!0,value:l,onChange:a=>m(a.target.value),placeholder:"example@nightbase.jp",className:"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"invite-name",className:"text-sm text-slate-700",children:"表示名（任意）"}),(0,b.jsx)(h.Input,{id:"invite-name",value:n,onChange:a=>o(a.target.value),placeholder:"NightBase 担当者",className:"border-slate-300 bg-white text-slate-900 placeholder:text-slate-400"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(i.Label,{htmlFor:"invite-role",className:"text-sm text-slate-700",children:"付与するロール"}),(0,b.jsxs)("select",{id:"invite-role",value:p,onChange:a=>q(a.target.value),className:"w-full rounded-xl border border-slate-300 bg-white px-3 py-2 text-sm text-slate-900",required:!0,children:[(0,b.jsx)("option",{value:"admin",children:"管理者"}),(0,b.jsx)("option",{value:"editor",children:"編集"}),(0,b.jsx)("option",{value:"viewer",children:"閲覧"})]})]}),(0,b.jsx)(f.Button,{type:"submit",className:"w-full",disabled:r,children:r?"送信中...":"招待メールを送信"})]})]})]})}function p(){return(0,b.jsx)(d.AdminProtected,{children:({supabase:a})=>(0,b.jsx)(n,{supabase:a})})}a.s(["default",()=>p,"dynamic",0,"force-dynamic"])}];

//# sourceMappingURL=%5Broot-of-the-server%5D__2af8a3dd._.js.map