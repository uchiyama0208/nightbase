{"version":3,"sources":["../../../../../../apps/app/src/app/app/%28main%29/attendance/AttendanceTable.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/app/src/app/app/%28main%29/attendance/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const AttendanceTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call AttendanceTable() from the server but AttendanceTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/app/src/app/app/(main)/attendance/AttendanceTable.tsx\",\n    \"AttendanceTable\",\n);\n","import { Suspense } from \"react\";\nimport type { Metadata } from \"next\";\nimport { redirect } from \"next/navigation\";\nimport { createServerClient } from \"@/lib/supabaseServerClient\";\nimport { AttendanceTable } from \"./AttendanceTable\";\nimport { getAppData } from \"../../data-access\";\n\nexport const metadata: Metadata = {\n\ttitle: \"勤怠\",\n};\n\nasync function getAttendanceData(roleParam?: string) {\n\tconst { user, profile } = await getAppData();\n\n\tif (!user) {\n\t\tredirect(\"/login\");\n\t}\n\n\tif (!profile || !profile.store_id) {\n\t\tredirect(\"/app/me\");\n\t}\n\n\tconst storeId = profile.store_id;\n\n\tconst supabase = await createServerClient();\n\n\tconst [rawRecordsResult, allProfilesResult] = await Promise.all([\n\t\tsupabase\n\t\t\t.from(\"time_cards\")\n\t\t\t.select(\"*, profiles!inner(id, display_name, role)\")\n\t\t\t.eq(\"profiles.store_id\", storeId)\n\t\t\t.order(\"work_date\", { ascending: false })\n\t\t\t.order(\"clock_in\", { ascending: false }),\n\t\tsupabase\n\t\t\t.from(\"profiles\")\n\t\t\t.select(\"id, display_name, display_name_kana, real_name, role\")\n\t\t\t.eq(\"store_id\", storeId)\n\t\t\t.order(\"display_name\")\n\t]);\n\n\tconst rawRecords = rawRecordsResult.data;\n\tconst allProfiles = allProfilesResult.data;\n\n\tconst roleFilter = roleParam?.toLowerCase() || \"cast\";\n\n\t// Transform time_cards data to AttendanceRecord format\n\tconst allRecords = (rawRecords || []).map((record: any) => {\n\t\tlet status = \"scheduled\";\n\t\tif (record.clock_in && !record.clock_out) {\n\t\t\tstatus = \"working\";\n\t\t} else if (record.clock_in && record.clock_out) {\n\t\t\tstatus = \"finished\";\n\t\t}\n\n\t\t// Use scheduled times if available, otherwise use clock times\n\t\tconst startTime = record.scheduled_start_time || record.clock_in;\n\t\tconst endTime = record.scheduled_end_time || record.clock_out;\n\n\t\treturn {\n\t\t\tid: record.id,\n\t\t\tuser_id: record.user_id,\n\t\t\tdate: record.work_date,\n\t\t\tstatus: status,\n\t\t\tstart_time: startTime,\n\t\t\tend_time: endTime,\n\t\t\tclock_in: record.clock_in,\n\t\t\tclock_out: record.clock_out,\n\t\t\tclock_in_time: record.clock_in,\n\t\t\tclock_out_time: record.clock_out,\n\t\t\tpickup_destination: record.pickup_destination,\n\t\t\tisVirtual: false,\n\t\t};\n\t});\n\n\treturn {\n\t\tallRecords,\n\t\tallProfiles: allProfiles || [],\n\t\troleFilter,\n\t};\n}\n\nfunction AttendanceSkeleton() {\n\treturn (\n\t\t<div className=\"space-y-4 animate-pulse\">\n\t\t\t<div className=\"h-8 w-1/3 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n\t\t\t<div className=\"h-64 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n\t\t</div>\n\t);\n}\n\nexport default async function AttendancePage({\n\tsearchParams,\n}: {\n\tsearchParams: Promise<{ role?: string }>;\n}) {\n\tconst params = await searchParams;\n\tconst roleParam = params.role;\n\tconst data = await getAttendanceData(roleParam);\n\tconst { allRecords, allProfiles, roleFilter } = data;\n\n\treturn (\n\t\t<div className=\"space-y-4\">\n\t\t\t<div className=\"flex flex-col md:flex-row md:items-center md:justify-between gap-4\">\n\t\t\t\t<div>\n\t\t\t\t\t<h1 className=\"text-xl md:text-2xl font-bold tracking-tight text-gray-900 dark:text-white\">\n\t\t\t\t\t\t勤怠\n\t\t\t\t\t</h1>\n\t\t\t\t\t<p className=\"mt-2 text-xs md:text-sm text-gray-600 dark:text-gray-400\">\n\t\t\t\t\t\tシフトの確認と出勤状況を管理します。\n\t\t\t\t\t</p>\n\t\t\t\t</div>\n\t\t\t</div>\n\n\t\t\t<AttendanceTable attendanceRecords={allRecords} profiles={allProfiles} roleFilter={roleFilter} />\n\t\t</div>\n\t);\n}\n\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n"],"names":[],"mappings":"+VAEO,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,2FACA,wEAHG,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,uEACA,mJCHJ,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,OAMA,eAAe,EAAkB,CAAkB,EAClD,GAAM,MAAE,CAAI,SAAE,CAAO,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,GAEtC,CAAC,GACJ,CAAA,EADU,AACV,EAAA,QAAA,AAAQ,EAAC,UAGN,AAAC,GAAY,EAAQ,MAAT,EAAiB,EAAE,AAClC,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,WAGV,IAAM,EAAU,EAAQ,QAAQ,CAE1B,EAAW,MAAM,CAAA,EAAA,EAAA,kBAAkB,AAAlB,IAEjB,CAAC,EAAkB,EAAkB,CAAG,MAAM,QAAQ,GAAG,CAAC,CAC/D,EACE,IAAI,CAAC,cACL,MAAM,CAAC,6CACP,EAAE,CAAC,oBAAqB,GACxB,KAAK,CAAC,YAAa,CAAE,WAAW,CAAM,GACtC,KAAK,CAAC,WAAY,CAAE,WAAW,CAAM,GACvC,EACE,IAAI,CAAC,YACL,MAAM,CAAC,wDACP,EAAE,CAAC,WAAY,GACf,KAAK,CAAC,gBACR,EAEK,EAAa,EAAiB,IAAI,CAClC,EAAc,EAAkB,IAAI,CAEpC,EAAa,GAAW,eAAiB,OA+B/C,MAAO,CACN,WA7BkB,CAAC,GAAc,EAAA,AAAE,EAAE,GAAG,CAAC,AAAC,IAC1C,IAAI,EAAS,YACT,EAAO,QAAQ,EAAI,CAAC,EAAO,SAAS,CACvC,CADyC,CAChC,UACC,EAAO,QAAQ,EAAI,EAAO,SAAS,EAAE,CAC/C,EAAS,UAAA,EAIV,IAAM,EAAY,EAAO,oBAAoB,EAAI,EAAO,QAAQ,CAC1D,EAAU,EAAO,kBAAkB,EAAI,EAAO,SAAS,CAE7D,MAAO,CACN,GAAI,EAAO,EAAE,CACb,QAAS,EAAO,OAAO,CACvB,KAAM,EAAO,SAAS,CACtB,OAAQ,EACR,WAAY,EACZ,SAAU,EACV,SAAU,EAAO,QAAQ,CACzB,UAAW,EAAO,SAAS,CAC3B,cAAe,EAAO,QAAQ,CAC9B,eAAgB,EAAO,SAAS,CAChC,mBAAoB,EAAO,kBAAkB,CAC7C,UAAW,EACZ,CACD,GAIC,YAAa,GAAe,EAAE,YAC9B,CACD,CACD,CAWe,eAAe,EAAe,cAC5C,CAAY,CAGZ,EAEA,IAAM,EAAY,CADH,MAAM,CAAA,EACI,IAAI,CAEvB,YAAE,CAAU,aAAE,CAAW,YAAE,CAAU,CAAE,CADhC,EACmC,IAD7B,EAAkB,GAGrC,MACC,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACd,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,8EACd,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACA,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,sFAA6E,OAG3F,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,oEAA2D,4BAM1E,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,kBAAmB,EAAY,SAAU,EAAa,WAAY,MAGtF,kCAEuB,6BA/GW,CACjC,MAAO,IACR,iBA8G0B","ignoreList":[0]}