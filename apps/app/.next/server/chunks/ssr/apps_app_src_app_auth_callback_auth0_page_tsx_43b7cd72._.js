module.exports=[23446,a=>{"use strict";let b;var c,d,e,f,g=a.i(87924),h=a.i(72131);function i(a,b){var c={};for(var d in a)Object.prototype.hasOwnProperty.call(a,d)&&0>b.indexOf(d)&&(c[d]=a[d]);if(null!=a&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(d=Object.getOwnPropertySymbols(a);e<d.length;e++)0>b.indexOf(d[e])&&Object.prototype.propertyIsEnumerable.call(a,d[e])&&(c[d[e]]=a[d[e]])}return c}"function"==typeof SuppressedError&&SuppressedError;var j="undefined"!=typeof globalThis?globalThis:a.g;function k(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}function l(a,b){return a(b={exports:{}},b.exports),b.exports}var m=l(function(a,b){Object.defineProperty(b,"__esModule",{value:!0});var c=function(){function a(){var a=this;this.locked=new Map,this.addToLocked=function(b,c){var d=a.locked.get(b);void 0===d?void 0===c?a.locked.set(b,[]):a.locked.set(b,[c]):void 0!==c&&(d.unshift(c),a.locked.set(b,d))},this.isLocked=function(b){return a.locked.has(b)},this.lock=function(b){return new Promise(function(c,d){a.isLocked(b)?a.addToLocked(b,c):(a.addToLocked(b),c())})},this.unlock=function(b){var c=a.locked.get(b);if(void 0!==c&&0!==c.length){var d=c.pop();a.locked.set(b,c),void 0!==d&&setTimeout(d,0)}else a.locked.delete(b)}}return a.getInstance=function(){return void 0===a.instance&&(a.instance=new a),a.instance},a}();b.default=function(){return c.getInstance()}});k(m);var n=k(l(function(a,b){var c=j&&j.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d.throw(a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})},d=j&&j.__generator||function(a,b){var c,d,e,f,g={label:0,sent:function(){if(1&e[0])throw e[1];return e[1]},trys:[],ops:[]};return f={next:h(0),throw:h(1),return:h(2)},"function"==typeof Symbol&&(f[Symbol.iterator]=function(){return this}),f;function h(f){return function(h){var i=[f,h];if(c)throw TypeError("Generator is already executing.");for(;g;)try{if(c=1,d&&(e=2&i[0]?d.return:i[0]?d.throw||((e=d.return)&&e.call(d),0):d.next)&&!(e=e.call(d,i[1])).done)return e;switch(d=0,e&&(i=[2&i[0],e.value]),i[0]){case 0:case 1:e=i;break;case 4:return g.label++,{value:i[1],done:!1};case 5:g.label++,d=i[1],i=[0];continue;case 7:i=g.ops.pop(),g.trys.pop();continue;default:if(!(e=(e=g.trys).length>0&&e[e.length-1])&&(6===i[0]||2===i[0])){g=0;continue}if(3===i[0]&&(!e||i[1]>e[0]&&i[1]<e[3])){g.label=i[1];break}if(6===i[0]&&g.label<e[1]){g.label=e[1],e=i;break}if(e&&g.label<e[2]){g.label=e[2],g.ops.push(i);break}e[2]&&g.ops.pop(),g.trys.pop();continue}i=b.call(a,g)}catch(a){i=[6,a],d=0}finally{c=e=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}}};Object.defineProperty(b,"__esModule",{value:!0});var e="browser-tabs-lock-key",f={key:function(a){return c(j,void 0,void 0,function(){return d(this,function(a){throw Error("Unsupported")})})},getItem:function(a){return c(j,void 0,void 0,function(){return d(this,function(a){throw Error("Unsupported")})})},clear:function(){return c(j,void 0,void 0,function(){return d(this,function(a){return[2,window.localStorage.clear()]})})},removeItem:function(a){return c(j,void 0,void 0,function(){return d(this,function(a){throw Error("Unsupported")})})},setItem:function(a,b){return c(j,void 0,void 0,function(){return d(this,function(a){throw Error("Unsupported")})})},keySync:function(a){return window.localStorage.key(a)},getItemSync:function(a){return window.localStorage.getItem(a)},clearSync:function(){return window.localStorage.clear()},removeItemSync:function(a){return window.localStorage.removeItem(a)},setItemSync:function(a,b){return window.localStorage.setItem(a,b)}};function g(a){return new Promise(function(b){return setTimeout(b,a)})}function h(a){for(var b="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",c="",d=0;d<a;d++)c+=b[Math.floor(Math.random()*b.length)];return c}b.default=function(){function a(b){this.acquiredIatSet=new Set,this.storageHandler=void 0,this.id=Date.now().toString()+h(15),this.acquireLock=this.acquireLock.bind(this),this.releaseLock=this.releaseLock.bind(this),this.releaseLock__private__=this.releaseLock__private__.bind(this),this.waitForSomethingToChange=this.waitForSomethingToChange.bind(this),this.refreshLockWhileAcquired=this.refreshLockWhileAcquired.bind(this),this.storageHandler=b,void 0===a.waiters&&(a.waiters=[])}return a.prototype.acquireLock=function(b,i){return void 0===i&&(i=5e3),c(this,void 0,void 0,function(){var c,j,k,l,m,n,o;return d(this,function(d){switch(d.label){case 0:c=Date.now()+h(4),j=Date.now()+i,k=e+"-"+b,l=void 0===this.storageHandler?f:this.storageHandler,d.label=1;case 1:return Date.now()<j?[4,g(30)]:[3,8];case 2:return d.sent(),null!==l.getItemSync(k)?[3,5]:(m=this.id+"-"+b+"-"+c,[4,g(Math.floor(25*Math.random()))]);case 3:return d.sent(),l.setItemSync(k,JSON.stringify({id:this.id,iat:c,timeoutKey:m,timeAcquired:Date.now(),timeRefreshed:Date.now()})),[4,g(30)];case 4:return d.sent(),null!==(n=l.getItemSync(k))&&(o=JSON.parse(n)).id===this.id&&o.iat===c?(this.acquiredIatSet.add(c),this.refreshLockWhileAcquired(k,c),[2,!0]):[3,7];case 5:return a.lockCorrector(void 0===this.storageHandler?f:this.storageHandler),[4,this.waitForSomethingToChange(j)];case 6:d.sent(),d.label=7;case 7:return c=Date.now()+h(4),[3,1];case 8:return[2,!1]}})})},a.prototype.refreshLockWhileAcquired=function(a,b){return c(this,void 0,void 0,function(){var e=this;return d(this,function(g){return setTimeout(function(){return c(e,void 0,void 0,function(){var c,e,g;return d(this,function(d){switch(d.label){case 0:return[4,m.default().lock(b)];case 1:return d.sent(),this.acquiredIatSet.has(b)?null===(e=(c=void 0===this.storageHandler?f:this.storageHandler).getItemSync(a))?m.default().unlock(b):((g=JSON.parse(e)).timeRefreshed=Date.now(),c.setItemSync(a,JSON.stringify(g)),m.default().unlock(b),this.refreshLockWhileAcquired(a,b)):m.default().unlock(b),[2]}})})},1e3),[2]})})},a.prototype.waitForSomethingToChange=function(b){return c(this,void 0,void 0,function(){return d(this,function(c){switch(c.label){case 0:return[4,new Promise(function(c){var d=!1,e=Date.now(),f=!1;function g(){if(f||(window.removeEventListener("storage",g),a.removeFromWaiting(g),clearTimeout(h),f=!0),!d){d=!0;var b=50-(Date.now()-e);b>0?setTimeout(c,b):c(null)}}window.addEventListener("storage",g),a.addToWaiting(g);var h=setTimeout(g,Math.max(0,b-Date.now()))})];case 1:return c.sent(),[2]}})})},a.addToWaiting=function(b){this.removeFromWaiting(b),void 0!==a.waiters&&a.waiters.push(b)},a.removeFromWaiting=function(b){void 0!==a.waiters&&(a.waiters=a.waiters.filter(function(a){return a!==b}))},a.notifyWaiters=function(){void 0!==a.waiters&&a.waiters.slice().forEach(function(a){return a()})},a.prototype.releaseLock=function(a){return c(this,void 0,void 0,function(){return d(this,function(b){switch(b.label){case 0:return[4,this.releaseLock__private__(a)];case 1:return[2,b.sent()]}})})},a.prototype.releaseLock__private__=function(b){return c(this,void 0,void 0,function(){var c,g,h,i;return d(this,function(d){switch(d.label){case 0:return c=void 0===this.storageHandler?f:this.storageHandler,g=e+"-"+b,null===(h=c.getItemSync(g))?[2]:(i=JSON.parse(h)).id!==this.id?[3,2]:[4,m.default().lock(i.iat)];case 1:d.sent(),this.acquiredIatSet.delete(i.iat),c.removeItemSync(g),m.default().unlock(i.iat),a.notifyWaiters(),d.label=2;case 2:return[2]}})})},a.lockCorrector=function(b){for(var c=Date.now()-5e3,d=[],f=0;;){var g=b.keySync(f);if(null===g)break;d.push(g),f++}for(var h=!1,i=0;i<d.length;i++){var j=d[i];if(j.includes(e)){var k=b.getItemSync(j);if(null!==k){var l=JSON.parse(k);(void 0===l.timeRefreshed&&l.timeAcquired<c||void 0!==l.timeRefreshed&&l.timeRefreshed<c)&&(b.removeItemSync(j),h=!0)}}}h&&a.notifyWaiters()},a.waiters=void 0,a}()}));let o={timeoutInSeconds:60},p={name:"auth0-spa-js",version:"2.9.1"},q=()=>Date.now();class r extends Error{constructor(a,b){super(b),this.error=a,this.error_description=b,Object.setPrototypeOf(this,r.prototype)}static fromPayload({error:a,error_description:b}){return new r(a,b)}}class s extends r{constructor(a,b,c,d=null){super(a,b),this.state=c,this.appState=d,Object.setPrototypeOf(this,s.prototype)}}class t extends r{constructor(a,b,c,d,e=null){super(a,b),this.connection=c,this.state=d,this.appState=e,Object.setPrototypeOf(this,t.prototype)}}class u extends r{constructor(){super("timeout","Timeout"),Object.setPrototypeOf(this,u.prototype)}}class v extends u{constructor(a){super(),this.popup=a,Object.setPrototypeOf(this,v.prototype)}}class w extends r{constructor(a){super("cancelled","Popup closed"),this.popup=a,Object.setPrototypeOf(this,w.prototype)}}class x extends r{constructor(a,b,c){super(a,b),this.mfa_token=c,Object.setPrototypeOf(this,x.prototype)}}class y extends r{constructor(a,b){super("missing_refresh_token",`Missing Refresh Token (audience: '${B(a,["default"])}', scope: '${B(b)}')`),this.audience=a,this.scope=b,Object.setPrototypeOf(this,y.prototype)}}class z extends r{constructor(a,b){super("missing_scopes",`Missing requested scopes after refresh (audience: '${B(a,["default"])}', missing scope: '${B(b)}')`),this.audience=a,this.scope=b,Object.setPrototypeOf(this,z.prototype)}}class A extends r{constructor(a){super("use_dpop_nonce","Server rejected DPoP proof: wrong nonce"),this.newDpopNonce=a,Object.setPrototypeOf(this,A.prototype)}}function B(a,b=[]){return a&&!b.includes(a)?a:""}let C=()=>{let a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz-_~.",b="";return Array.from(window.crypto.getRandomValues(new Uint8Array(43))).forEach(c=>b+=a[c%a.length]),b},D=[{key:"name",type:["string"]},{key:"version",type:["string","number"]},{key:"env",type:["object"]}],E=a=>{let b;var{clientId:c}=a;return new URLSearchParams(Object.keys(b=Object.assign({client_id:c},i(a,["clientId"]))).filter(a=>void 0!==b[a]).reduce((a,c)=>Object.assign(Object.assign({},a),{[c]:b[c]}),{})).toString()},F=async a=>{let b=window.crypto.subtle.digest({name:"SHA-256"},(new TextEncoder).encode(a));return await b},G=a=>decodeURIComponent(atob(a.replace(/_/g,"/").replace(/-/g,"+")).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")),H=a=>{var b;let c,d=new Uint8Array(a);return b=window.btoa(String.fromCharCode(...Array.from(d))),c={"+":"-","/":"_","=":""},b.replace(/[+/=]/g,a=>c[a])},I=new TextEncoder,J=new TextDecoder;function K(a){return"string"==typeof a?I.encode(a):J.decode(a)}function L(a){if("number"!=typeof a.modulusLength||a.modulusLength<2048)throw new O(`${a.name} modulusLength must be at least 2048 bits`)}async function M(a,c,d){var e,f,g;if(!1===d.usages.includes("sign"))throw TypeError('private CryptoKey instances used for signing assertions must include "sign" in their "usages"');let h=`${(e=K(JSON.stringify(a)),b(e))}.${(f=K(JSON.stringify(c)),b(f))}`;return`${h}.${g=await crypto.subtle.sign(function(a){switch(a.algorithm.name){case"ECDSA":return{name:a.algorithm.name,hash:"SHA-256"};case"RSA-PSS":return L(a.algorithm),{name:a.algorithm.name,saltLength:32};case"RSASSA-PKCS1-v1_5":return L(a.algorithm),{name:a.algorithm.name};case"Ed25519":return{name:a.algorithm.name}}throw new N}(d),d,K(h)),b(g)}`}b=Uint8Array.prototype.toBase64?a=>(a instanceof ArrayBuffer&&(a=new Uint8Array(a)),a.toBase64({alphabet:"base64url",omitPadding:!0})):a=>{a instanceof ArrayBuffer&&(a=new Uint8Array(a));let b=[];for(let c=0;c<a.byteLength;c+=32768)b.push(String.fromCharCode.apply(null,a.subarray(c,c+32768)));return btoa(b.join("")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")};class N extends Error{constructor(a){var b;super(null!=a?a:"operation not supported"),this.name=this.constructor.name,null==(b=Error.captureStackTrace)||b.call(Error,this,this.constructor)}}class O extends Error{constructor(a){var b;super(a),this.name=this.constructor.name,null==(b=Error.captureStackTrace)||b.call(Error,this,this.constructor)}}function P(a){return a instanceof CryptoKey}function Q(a){return P(a)&&"public"===a.type}async function R(a,c,d,e,f,g){var h;let i=null==a?void 0:a.privateKey,j=null==a?void 0:a.publicKey;if(!P(i)||"private"!==i.type)throw TypeError('"keypair.privateKey" must be a private CryptoKey');if(!Q(j))throw TypeError('"keypair.publicKey" must be a public CryptoKey');if(!0!==j.extractable)throw TypeError('"keypair.publicKey.extractable" must be true');if("string"!=typeof c)throw TypeError('"htu" must be a string');if("string"!=typeof d)throw TypeError('"htm" must be a string');if(void 0!==e&&"string"!=typeof e)throw TypeError('"nonce" must be a string or undefined');if(void 0!==f&&"string"!=typeof f)throw TypeError('"accessToken" must be a string or undefined');if(void 0!==g&&("object"!=typeof g||null===g||Array.isArray(g)))throw TypeError('"additional" must be an object');return M({alg:function(a){switch(a.algorithm.name){case"RSA-PSS":if("SHA-256"===a.algorithm.hash.name)return"PS256";throw new N("unsupported RsaHashedKeyAlgorithm hash name");case"RSASSA-PKCS1-v1_5":if("SHA-256"===a.algorithm.hash.name)return"RS256";throw new N("unsupported RsaHashedKeyAlgorithm hash name");case"ECDSA":if("P-256"===a.algorithm.namedCurve)return"ES256";throw new N("unsupported EcKeyAlgorithm namedCurve");case"Ed25519":return"Ed25519";default:throw new N("unsupported CryptoKey algorithm name")}}(i),typ:"dpop+jwt",jwk:await S(j)},Object.assign(Object.assign({},g),{iat:Math.floor(Date.now()/1e3),jti:crypto.randomUUID(),htm:d,nonce:e,htu:c,ath:f?(h=await crypto.subtle.digest("SHA-256",K(f)),b(h)):void 0}),i)}async function S(a){let{kty:b,e:c,n:d,x:e,y:f,crv:g}=await crypto.subtle.exportKey("jwk",a);return{kty:b,crv:g,e:c,n:d,x:e,y:f}}let T=["authorization_code","refresh_token","urn:ietf:params:oauth:grant-type:token-exchange"],U=async(a,b)=>{let c=await fetch(a,b);return{ok:c.ok,json:await c.json(),headers:[...c.headers].reduce((a,[b,c])=>(a[b]=c,a),{})}},V=async(a,b,c)=>{let d,e=new AbortController;return b.signal=e.signal,Promise.race([U(a,b),new Promise((a,b)=>{d=setTimeout(()=>{e.abort(),b(Error("Timeout when executing 'fetch'"))},c)})]).finally(()=>{clearTimeout(d)})},W=async(a,b,c,d,e,f,g,h)=>{var i;return i={auth:{audience:b,scope:c},timeout:e,fetchUrl:a,fetchOptions:d,useFormData:g,useMrrt:h},new Promise(function(a,b){let c=new MessageChannel;c.port1.onmessage=function(d){d.data.error?b(Error(d.data.error)):a(d.data),c.port1.close()},f.postMessage(i,[c.port2])})},X=async(a,b,c,d,e,f,g=1e4,h)=>e?W(a,b,c,d,g,e,f,h):V(a,d,g);async function Y(a,b,c,d,e,f,g,h,j,k){let l;if(j){let b=await j.generateProof({url:a,method:e.method||"GET",nonce:await j.getNonce()});e.headers=Object.assign(Object.assign({},e.headers),{dpop:b})}let m,n=null;for(let i=0;i<3;i++)try{m=await X(a,c,d,e,f,g,b,h),n=null;break}catch(a){n=a}if(n)throw n;let o=m.json,{error:p,error_description:q}=o,s=i(o,["error","error_description"]),{headers:t,ok:u}=m;if(j&&(l=t["dpop-nonce"])&&await j.setNonce(l),!u){let i=q||`HTTP error. Unable to fetch ${a}`;if("mfa_required"===p)throw new x(p,i,s.mfa_token);if("missing_refresh_token"===p)throw new y(c,d);if("use_dpop_nonce"===p){if(!j||!l||k)throw new A(l);return Y(a,b,c,d,e,f,g,h,j,!0)}throw new r(p||"request_error",i)}return s}async function Z(a,b){let c;var d,{baseUrl:e,timeout:f,audience:g,scope:h,auth0Client:j,useFormData:k,useMrrt:l,dpop:m}=a,n=i(a,["baseUrl","timeout","audience","scope","auth0Client","useFormData","useMrrt","dpop"]);let o="urn:ietf:params:oauth:grant-type:token-exchange"===n.grant_type,q="refresh_token"===n.grant_type&&l,r=Object.assign(Object.assign(Object.assign(Object.assign({},n),o&&g&&{audience:g}),o&&h&&{scope:h}),q&&{audience:g,scope:h}),s=k?E(r):JSON.stringify(r),t=(d=n.grant_type,T.includes(d));return await Y(`${e}/oauth/token`,f,g||"default",h,{method:"POST",body:s,headers:{"Content-Type":k?"application/x-www-form-urlencoded":"application/json","Auth0-Client":btoa(JSON.stringify(Object.keys(c=j||p).reduce((a,b)=>{let d=D.find(a=>a.key===b);return d&&d.type.includes(typeof c[b])&&(a[b]=c[b]),a},{})))}},b,k,l,t?m:void 0)}let $=(...a)=>Array.from(new Set(a.filter(Boolean).join(" ").trim().split(/\s+/))).join(" "),_=(a,b,c)=>{let d;return c&&(d=a[c]),d||(d=a.default),$(d,b)};class aa{constructor(a,b="@@auth0spajs@@",c){this.prefix=b,this.suffix=c,this.clientId=a.clientId,this.scope=a.scope,this.audience=a.audience}toKey(){return[this.prefix,this.clientId,this.audience,this.scope,this.suffix].filter(Boolean).join("::")}static fromKey(a){let[b,c,d,e]=a.split("::");return new aa({clientId:c,scope:e,audience:d},b)}static fromCacheEntry(a){let{scope:b,audience:c,client_id:d}=a;return new aa({scope:b,audience:c,clientId:d})}}class ab{set(a,b){localStorage.setItem(a,JSON.stringify(b))}get(a){let b=window.localStorage.getItem(a);if(b)try{return JSON.parse(b)}catch(a){return}}remove(a){localStorage.removeItem(a)}allKeys(){return Object.keys(window.localStorage).filter(a=>a.startsWith("@@auth0spajs@@"))}}class ac{constructor(){this.enclosedCache=function(){let a={};return{set(b,c){a[b]=c},get(b){let c=a[b];if(c)return c},remove(b){delete a[b]},allKeys:()=>Object.keys(a)}}()}}class ad{constructor(a,b,c){this.cache=a,this.keyManifest=b,this.nowProvider=c||q}async setIdToken(a,b,c){var d;let e=this.getIdTokenCacheKey(a);await this.cache.set(e,{id_token:b,decodedToken:c}),await (null==(d=this.keyManifest)?void 0:d.add(e))}async getIdToken(a){let b=await this.cache.get(this.getIdTokenCacheKey(a.clientId));if(!b&&a.scope&&a.audience){let b=await this.get(a);if(!b||!b.id_token||!b.decodedToken)return;return{id_token:b.id_token,decodedToken:b.decodedToken}}if(b)return{id_token:b.id_token,decodedToken:b.decodedToken}}async get(a,b=0,c=!1,d){var e;let f=await this.cache.get(a.toKey());if(!f){let b=await this.getCacheKeys();if(!b)return;let e=this.matchExistingCacheKey(a,b);if(e&&(f=await this.cache.get(e)),!e&&c&&"cache-only"!==d)return this.getEntryWithRefreshToken(a,b)}if(!f)return;let g=Math.floor(await this.nowProvider()/1e3);return f.expiresAt-b<g?f.body.refresh_token?this.modifiedCachedEntry(f,a):(await this.cache.remove(a.toKey()),void await (null==(e=this.keyManifest)?void 0:e.remove(a.toKey()))):f.body}async modifiedCachedEntry(a,b){return a.body={refresh_token:a.body.refresh_token,audience:a.body.audience,scope:a.body.scope},await this.cache.set(b.toKey(),a),{refresh_token:a.body.refresh_token,audience:a.body.audience,scope:a.body.scope}}async set(a){var b;let c=new aa({clientId:a.client_id,scope:a.scope,audience:a.audience}),d=await this.wrapCacheEntry(a);await this.cache.set(c.toKey(),d),await (null==(b=this.keyManifest)?void 0:b.add(c.toKey()))}async remove(a,b,c){let d=new aa({clientId:a,scope:c,audience:b});await this.cache.remove(d.toKey())}async clear(a){var b;let c=await this.getCacheKeys();c&&(await c.filter(b=>!a||b.includes(a)).reduce(async(a,b)=>{await a,await this.cache.remove(b)},Promise.resolve()),await (null==(b=this.keyManifest)?void 0:b.clear()))}async wrapCacheEntry(a){return{body:a,expiresAt:Math.floor(await this.nowProvider()/1e3)+a.expires_in}}async getCacheKeys(){var a;return this.keyManifest?null==(a=await this.keyManifest.get())?void 0:a.keys:this.cache.allKeys?this.cache.allKeys():void 0}getIdTokenCacheKey(a){return new aa({clientId:a},"@@auth0spajs@@","@@user@@").toKey()}matchExistingCacheKey(a,b){return b.filter(b=>{var c;let d=aa.fromKey(b),e=new Set(d.scope&&d.scope.split(" ")),f=(null==(c=a.scope)?void 0:c.split(" "))||[],g=d.scope&&f.reduce((a,b)=>a&&e.has(b),!0);return"@@auth0spajs@@"===d.prefix&&d.clientId===a.clientId&&d.audience===a.audience&&g})[0]}async getEntryWithRefreshToken(a,b){var c;for(let d of b){let b=aa.fromKey(d);if("@@auth0spajs@@"===b.prefix&&b.clientId===a.clientId){let b=await this.cache.get(d);if(null==(c=null==b?void 0:b.body)?void 0:c.refresh_token)return this.modifiedCachedEntry(b,a)}}}async updateEntry(a,b){var c;let d=await this.getCacheKeys();if(d)for(let e of d){let d=await this.cache.get(e);if((null==(c=null==d?void 0:d.body)?void 0:c.refresh_token)===a){let a=Object.assign(Object.assign({},d.body),{refresh_token:b});await this.set(a)}}}}class ae{constructor(a,b,c){this.storage=a,this.clientId=b,this.cookieDomain=c,this.storageKey=`a0.spajs.txs.${this.clientId}`}create(a){this.storage.save(this.storageKey,a,{daysUntilExpire:1,cookieDomain:this.cookieDomain})}get(){return this.storage.get(this.storageKey)}remove(){this.storage.remove(this.storageKey,{cookieDomain:this.cookieDomain})}}let af=["iss","aud","exp","nbf","iat","jti","azp","nonce","auth_time","at_hash","c_hash","acr","amr","sub_jwk","cnf","sip_from_tag","sip_date","sip_callid","sip_cseq_num","sip_via_branch","orig","dest","mky","events","toe","txn","rph","sid","vot","vtm"];var ag=l(function(a,b){var c=j&&j.__assign||function(){return(c=Object.assign||function(a){for(var b,c=1,d=arguments.length;c<d;c++)for(var e in b=arguments[c])Object.prototype.hasOwnProperty.call(b,e)&&(a[e]=b[e]);return a}).apply(this,arguments)};function d(a,b){if(!b)return"";var c="; "+a;return!0===b?c:c+"="+b}function e(a,b,c){return encodeURIComponent(a).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent).replace(/\(/g,"%28").replace(/\)/g,"%29")+"="+encodeURIComponent(b).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent)+function(a){if("number"==typeof a.expires){var b=new Date;b.setMilliseconds(b.getMilliseconds()+864e5*a.expires),a.expires=b}return d("Expires",a.expires?a.expires.toUTCString():"")+d("Domain",a.domain)+d("Path",a.path)+d("Secure",a.secure)+d("SameSite",a.sameSite)}(c)}function f(a){for(var b={},c=a?a.split("; "):[],d=/(%[\dA-F]{2})+/gi,e=0;e<c.length;e++){var f=c[e].split("="),g=f.slice(1).join("=");'"'===g.charAt(0)&&(g=g.slice(1,-1));try{b[f[0].replace(d,decodeURIComponent)]=g.replace(d,decodeURIComponent)}catch(a){}}return b}function g(){return f(document.cookie)}function h(a,b,d){document.cookie=e(a,b,c({path:"/"},d))}b.__esModule=!0,b.encode=e,b.parse=f,b.getAll=g,b.get=function(a){return g()[a]},b.set=h,b.remove=function(a,b){h(a,"",c(c({},b),{expires:-1}))}});k(ag),ag.encode,ag.parse,ag.getAll;var ah=ag.get,ai=ag.set,aj=ag.remove;let ak={get(a){let b=ah(a);if(void 0!==b)return JSON.parse(b)},save(a,b,c){let d={};"https:"===window.location.protocol&&(d={secure:!0,sameSite:"none"}),(null==c?void 0:c.daysUntilExpire)&&(d.expires=c.daysUntilExpire),(null==c?void 0:c.cookieDomain)&&(d.domain=c.cookieDomain),ai(a,JSON.stringify(b),d)},remove(a,b){let c={};(null==b?void 0:b.cookieDomain)&&(c.domain=b.cookieDomain),aj(a,c)}},al={get:a=>ak.get(a)||ak.get(`_legacy_${a}`),save(a,b,c){let d={};"https:"===window.location.protocol&&(d={secure:!0}),(null==c?void 0:c.daysUntilExpire)&&(d.expires=c.daysUntilExpire),(null==c?void 0:c.cookieDomain)&&(d.domain=c.cookieDomain),ai(`_legacy_${a}`,JSON.stringify(b),d),ak.save(a,b,c)},remove(a,b){let c={};(null==b?void 0:b.cookieDomain)&&(c.domain=b.cookieDomain),aj(a,c),ak.remove(a,b),ak.remove(`_legacy_${a}`,b)}},am={get(a){if("undefined"==typeof sessionStorage)return;let b=sessionStorage.getItem(a);return null!=b?JSON.parse(b):void 0},save(a,b){sessionStorage.setItem(a,JSON.stringify(b))},remove(a){sessionStorage.removeItem(a)}};(c=d||(d={})).Code="code",c.ConnectCode="connect_code";let an={};class ao{constructor(a,b){this.cache=a,this.clientId=b,this.manifestKey=this.createManifestKeyFrom(this.clientId)}async add(a){var b;let c=new Set((null==(b=await this.cache.get(this.manifestKey))?void 0:b.keys)||[]);c.add(a),await this.cache.set(this.manifestKey,{keys:[...c]})}async remove(a){let b=await this.cache.get(this.manifestKey);if(b){let c=new Set(b.keys);return c.delete(a),c.size>0?await this.cache.set(this.manifestKey,{keys:[...c]}):await this.cache.remove(this.manifestKey)}}get(){return this.cache.get(this.manifestKey)}clear(){return this.cache.remove(this.manifestKey)}createManifestKeyFrom(a){return`@@auth0spajs@@::${a}`}}let ap={memory:()=>(new ac).enclosedCache,localstorage:()=>new ab},aq=a=>ap[a],ar=a=>{let{openUrl:b,onRedirect:c}=a;return Object.assign(Object.assign({},i(a,["openUrl","onRedirect"])),{openUrl:!1===b||b?b:c})},as=(a,b)=>{let c=(null==b?void 0:b.split(" "))||[];return((null==a?void 0:a.split(" "))||[]).every(a=>c.includes(a))},at={NONCE:"nonce",KEYPAIR:"keypair"};class au{constructor(a){this.clientId=a}getVersion(){return 1}createDbHandle(){let a=window.indexedDB.open("auth0-spa-js",this.getVersion());return new Promise((b,c)=>{a.onupgradeneeded=()=>Object.values(at).forEach(b=>a.result.createObjectStore(b)),a.onerror=()=>c(a.error),a.onsuccess=()=>b(a.result)})}async getDbHandle(){return this.dbHandle||(this.dbHandle=await this.createDbHandle()),this.dbHandle}async executeDbRequest(a,b,c){let d=c((await this.getDbHandle()).transaction(a,b).objectStore(a));return new Promise((a,b)=>{d.onsuccess=()=>a(d.result),d.onerror=()=>b(d.error)})}buildKey(a){let b=a?`_${a}`:"auth0";return`${this.clientId}::${b}`}setNonce(a,b){return this.save(at.NONCE,this.buildKey(b),a)}setKeyPair(a){return this.save(at.KEYPAIR,this.buildKey(),a)}async save(a,b,c){await this.executeDbRequest(a,"readwrite",a=>a.put(c,b))}findNonce(a){return this.find(at.NONCE,this.buildKey(a))}findKeyPair(){return this.find(at.KEYPAIR,this.buildKey())}find(a,b){return this.executeDbRequest(a,"readonly",a=>a.get(b))}async deleteBy(a,b){let c=await this.executeDbRequest(a,"readonly",a=>a.getAllKeys());null==c||c.filter(b).map(b=>this.executeDbRequest(a,"readwrite",a=>a.delete(b)))}deleteByClientId(a,b){return this.deleteBy(a,a=>"string"==typeof a&&a.startsWith(`${b}::`))}clearNonces(){return this.deleteByClientId(at.NONCE,this.clientId)}clearKeyPairs(){return this.deleteByClientId(at.KEYPAIR,this.clientId)}}class av{constructor(a){this.storage=new au(a)}getNonce(a){return this.storage.findNonce(a)}setNonce(a,b){return this.storage.setNonce(a,b)}async getOrGenerateKeyPair(){let a=await this.storage.findKeyPair();return a||(a=await async function(a,b){var c;let d;if("string"!=typeof a||0===a.length)throw TypeError('"alg" must be a non-empty string');switch(a){case"PS256":d={name:"RSA-PSS",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"RS256":d={name:"RSASSA-PKCS1-v1_5",hash:"SHA-256",modulusLength:2048,publicExponent:new Uint8Array([1,0,1])};break;case"ES256":d={name:"ECDSA",namedCurve:"P-256"};break;case"Ed25519":d={name:"Ed25519"};break;default:throw new N}return crypto.subtle.generateKey(d,null!=(c=null==b?void 0:b.extractable)&&c,["sign","verify"])}("ES256",{extractable:!1}),await this.storage.setKeyPair(a)),a}async generateProof(a){return function({keyPair:a,url:b,method:c,nonce:d,accessToken:e}){let f;return R(a,((f=new URL(b)).search="",f.hash="",f.href),c,d,e)}(Object.assign({keyPair:await this.getOrGenerateKeyPair()},a))}async calculateThumbprint(){return async function(a){var c;let d;if(!Q(a))throw TypeError('"publicKey" must be a public CryptoKey');if(!0!==a.extractable)throw TypeError('"publicKey.extractable" must be true');let e=await S(a);switch(e.kty){case"EC":d={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":d={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":d={e:e.e,kty:e.kty,n:e.n};break;default:throw new N("unsupported JWK kty")}return c=await crypto.subtle.digest({name:"SHA-256"},K(JSON.stringify(d))),b(c)}((await this.getOrGenerateKeyPair()).publicKey)}async clear(){await Promise.all([this.storage.clearNonces(),this.storage.clearKeyPairs()])}}(e=f||(f={})).Bearer="Bearer",e.DPoP="DPoP";class aw{constructor(a,b){this.hooks=b,this.config=Object.assign(Object.assign({},a),{fetch:a.fetch||fetch})}isAbsoluteUrl(a){return/^(https?:)?\/\//i.test(a)}buildUrl(a,b){if(b){if(this.isAbsoluteUrl(b))return b;if(a)return`${a.replace(/\/?\/$/,"")}/${b.replace(/^\/+/,"")}`}throw TypeError("`url` must be absolute or `baseUrl` non-empty.")}getAccessToken(a){return this.config.getAccessToken?this.config.getAccessToken(a):this.hooks.getAccessToken(a)}extractUrl(a){return"string"==typeof a?a:a instanceof URL?a.href:a.url}buildBaseRequest(a,b){if(!this.config.baseUrl)return new Request(a,b);let c=this.buildUrl(this.config.baseUrl,this.extractUrl(a)),d=a instanceof Request?new Request(c,a):c;return new Request(d,b)}setAuthorizationHeader(a,b,c=f.Bearer){a.headers.set("authorization",`${c} ${b}`)}async setDpopProofHeader(a,b){if(!this.config.dpopNonceId)return;let c=await this.hooks.getDpopNonce(),d=await this.hooks.generateDpopProof({accessToken:b,method:a.method,nonce:c,url:a.url});a.headers.set("dpop",d)}async prepareRequest(a,b){let c,d,e=await this.getAccessToken(b);"string"==typeof e?(c=this.config.dpopNonceId?f.DPoP:f.Bearer,d=e):(c=e.token_type,d=e.access_token),this.setAuthorizationHeader(a,d,c),c===f.DPoP&&await this.setDpopProofHeader(a,d)}getHeader(a,b){return Array.isArray(a)?new Headers(a).get(b)||"":"function"==typeof a.get?a.get(b)||"":a[b]||""}hasUseDpopNonceError(a){if(401!==a.status)return!1;let b=this.getHeader(a.headers,"www-authenticate");return b.includes("invalid_dpop_nonce")||b.includes("use_dpop_nonce")}async handleResponse(a,b){let c=this.getHeader(a.headers,"dpop-nonce");if(c&&await this.hooks.setDpopNonce(c),!this.hasUseDpopNonceError(a))return a;if(!c||!b.onUseDpopNonceError)throw new A(c);return b.onUseDpopNonceError()}async internalFetchWithAuth(a,b,c,d){let e=this.buildBaseRequest(a,b);await this.prepareRequest(e,d);let f=await this.config.fetch(e);return this.handleResponse(f,c)}fetchWithAuth(a,b,c){let d={onUseDpopNonceError:()=>this.internalFetchWithAuth(a,b,Object.assign(Object.assign({},d),{onUseDpopNonceError:void 0}),c)};return this.internalFetchWithAuth(a,b,d,c)}}class ax{constructor(a,b){this.myAccountFetcher=a,this.apiBase=b}async connectAccount(a){let b=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/connect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return this._handleResponse(b)}async completeAccount(a){let b=await this.myAccountFetcher.fetchWithAuth(`${this.apiBase}v1/connected-accounts/complete`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});return this._handleResponse(b)}async _handleResponse(a){let b;try{b=await a.text(),b=JSON.parse(b)}catch(c){throw new ay({type:"invalid_json",status:a.status,title:"Invalid JSON response",detail:b||String(c)})}if(a.ok)return b;throw new ay(b)}}class ay extends Error{constructor({type:a,status:b,title:c,detail:d,validation_errors:e}){super(d),this.name="MyAccountApiError",this.type=a,this.status=b,this.title=c,this.detail=d,this.validation_errors=e,Object.setPrototypeOf(this,ay.prototype)}}let az=new n;class aA{constructor(a){var b;let c,d,e;if(this.userCache=(new ac).enclosedCache,this.activeLockKeys=new Set,this.defaultOptions={authorizationParams:{scope:"openid profile email"},useRefreshTokensFallback:!1,useFormData:!0},this._releaseLockOnPageHide=async()=>{for(let a of Array.from(this.activeLockKeys))await az.releaseLock(a);this.activeLockKeys.clear(),window.removeEventListener("pagehide",this._releaseLockOnPageHide)},this.options=Object.assign(Object.assign(Object.assign({},this.defaultOptions),a),{authorizationParams:Object.assign(Object.assign({},this.defaultOptions.authorizationParams),a.authorizationParams)}),a.cache&&a.cacheLocation&&console.warn("Both `cache` and `cacheLocation` options have been specified in the Auth0Client configuration; ignoring `cacheLocation` and using `cache`."),a.cache)d=a.cache;else{if(!aq(c=a.cacheLocation||"memory"))throw Error(`Invalid cache location "${c}"`);d=aq(c)()}this.httpTimeoutMs=a.httpTimeoutInSeconds?1e3*a.httpTimeoutInSeconds:1e4,this.cookieStorage=!1===a.legacySameSiteCookie?ak:al,this.orgHintCookieName=`auth0.${this.options.clientId}.organization_hint`,this.isAuthenticatedCookieName=(e=this.options.clientId,`auth0.${e}.is.authenticated`),this.sessionCheckExpiryDays=a.sessionCheckExpiryDays||1;const f=a.useCookiesForTransactions?this.cookieStorage:am;this.scope=((a,b,...c)=>{if("object"!=typeof a)return{default:$(b,a,...c)};let d={default:$(b,...c)};return Object.keys(a).forEach(e=>{let f=a[e];d[e]=$(b,f,...c)}),d})(this.options.authorizationParams.scope,"openid",this.options.useRefreshTokens?"offline_access":""),this.transactionManager=new ae(f,this.options.clientId,this.options.cookieDomain),this.nowProvider=this.options.nowProvider||q,this.cacheManager=new ad(d,d.allKeys?void 0:new ao(d,this.options.clientId),this.nowProvider),this.dpop=this.options.useDpop?new av(this.options.clientId):void 0,this.domainUrl=(b=this.options.domain,/^https?:\/\//.test(b)?b:`https://${b}`),this.tokenIssuer=((a,b)=>a?a.startsWith("https://")?a:`https://${a}/`:`${b}/`)(this.options.issuer,this.domainUrl);const g=`${this.domainUrl}/me/`,h=this.createFetcher(Object.assign(Object.assign({},this.options.useDpop&&{dpopNonceId:"__auth0_my_account_api__"}),{getAccessToken:()=>this.getTokenSilently({authorizationParams:{scope:"create:me:connected_accounts",audience:g},detailedResponse:!0})}));this.myAccountApi=new ax(h,g)}_url(a){let b=encodeURIComponent(btoa(JSON.stringify(this.options.auth0Client||p)));return`${this.domainUrl}${a}&auth0Client=${b}`}_authorizeUrl(a){return this._url(`/authorize?${E(a)}`)}async _verifyIdToken(a,b,c){var d;let e=await this.nowProvider();return(a=>{if(!a.id_token)throw Error("ID token is required but missing");let b=(a=>{let b=a.split("."),[c,d,e]=b;if(3!==b.length||!c||!d||!e)throw Error("ID token could not be decoded");let f=JSON.parse(G(d)),g={__raw:a},h={};return Object.keys(f).forEach(a=>{g[a]=f[a],af.includes(a)||(h[a]=f[a])}),{encoded:{header:c,payload:d,signature:e},header:JSON.parse(G(c)),claims:g,user:h}})(a.id_token);if(!b.claims.iss)throw Error("Issuer (iss) claim must be a string present in the ID token");if(b.claims.iss!==a.iss)throw Error(`Issuer (iss) claim mismatch in the ID token; expected "${a.iss}", found "${b.claims.iss}"`);if(!b.user.sub)throw Error("Subject (sub) claim must be a string present in the ID token");if("RS256"!==b.header.alg)throw Error(`Signature algorithm of "${b.header.alg}" is not supported. Expected the ID token to be signed with "RS256".`);if(!b.claims.aud||"string"!=typeof b.claims.aud&&!Array.isArray(b.claims.aud))throw Error("Audience (aud) claim must be a string or array of strings present in the ID token");if(Array.isArray(b.claims.aud)){if(!b.claims.aud.includes(a.aud))throw Error(`Audience (aud) claim mismatch in the ID token; expected "${a.aud}" but was not one of "${b.claims.aud.join(", ")}"`);if(b.claims.aud.length>1){if(!b.claims.azp)throw Error("Authorized Party (azp) claim must be a string present in the ID token when Audience (aud) claim has multiple values");if(b.claims.azp!==a.aud)throw Error(`Authorized Party (azp) claim mismatch in the ID token; expected "${a.aud}", found "${b.claims.azp}"`)}}else if(b.claims.aud!==a.aud)throw Error(`Audience (aud) claim mismatch in the ID token; expected "${a.aud}" but found "${b.claims.aud}"`);if(a.nonce){if(!b.claims.nonce)throw Error("Nonce (nonce) claim must be a string present in the ID token");if(b.claims.nonce!==a.nonce)throw Error(`Nonce (nonce) claim mismatch in the ID token; expected "${a.nonce}", found "${b.claims.nonce}"`)}if(a.max_age&&"number"!=typeof b.claims.auth_time)throw Error("Authentication Time (auth_time) claim must be a number present in the ID token when Max Age (max_age) is specified");if(null==b.claims.exp||"number"!=typeof b.claims.exp)throw Error("Expiration Time (exp) claim must be a number present in the ID token");if("number"!=typeof b.claims.iat)throw Error("Issued At (iat) claim must be a number present in the ID token");let c=a.leeway||60,d=new Date(a.now||Date.now()),e=new Date(0);if(e.setUTCSeconds(b.claims.exp+c),d>e)throw Error(`Expiration Time (exp) claim error in the ID token; current time (${d}) is after expiration time (${e})`);if(null!=b.claims.nbf&&"number"==typeof b.claims.nbf){let a=new Date(0);if(a.setUTCSeconds(b.claims.nbf-c),d<a)throw Error(`Not Before time (nbf) claim in the ID token indicates that this token can't be used just yet. Current time (${d}) is before ${a}`)}if(null!=b.claims.auth_time&&"number"==typeof b.claims.auth_time){let e=new Date(0);if(e.setUTCSeconds(parseInt(b.claims.auth_time)+a.max_age+c),d>e)throw Error(`Authentication Time (auth_time) claim in the ID token indicates that too much time has passed since the last end-user authentication. Current time (${d}) is after last auth at ${e}`)}if(a.organization){let c=a.organization.trim();if(c.startsWith("org_")){if(!b.claims.org_id)throw Error("Organization ID (org_id) claim must be a string present in the ID token");if(c!==b.claims.org_id)throw Error(`Organization ID (org_id) claim mismatch in the ID token; expected "${c}", found "${b.claims.org_id}"`)}else{let a=c.toLowerCase();if(!b.claims.org_name)throw Error("Organization Name (org_name) claim must be a string present in the ID token");if(a!==b.claims.org_name)throw Error(`Organization Name (org_name) claim mismatch in the ID token; expected "${a}", found "${b.claims.org_name}"`)}}return b})({iss:this.tokenIssuer,aud:this.options.clientId,id_token:a,nonce:b,organization:c,leeway:this.options.leeway,max_age:"string"!=typeof(d=this.options.authorizationParams.max_age)?d:parseInt(d,10)||void 0,now:e})}_processOrgHint(a){a?this.cookieStorage.save(this.orgHintCookieName,a,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}):this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain})}async _prepareAuthorizeUrl(a,b,c){var d;let e,f,g,h,i=btoa(C()),j=btoa(C()),k=C(),l=H(await F(k)),m=await (null==(d=this.dpop)?void 0:d.calculateThumbprint()),n=(e=this.options,f=this.scope,g=a.redirect_uri||this.options.authorizationParams.redirect_uri||c,h=null==b?void 0:b.response_mode,Object.assign(Object.assign(Object.assign({client_id:e.clientId},e.authorizationParams),a),{scope:_(f,a.scope,a.audience),response_type:"code",response_mode:h||"query",state:i,nonce:j,redirect_uri:g||e.authorizationParams.redirect_uri,code_challenge:l,code_challenge_method:"S256",dpop_jkt:m})),o=this._authorizeUrl(n);return{nonce:j,code_verifier:k,scope:n.scope,audience:n.audience||"default",redirect_uri:n.redirect_uri,state:i,url:o}}async loginWithPopup(a,b){var c;let d,e,f;if(a=a||{},!(b=b||{}).popup&&(b.popup=(d=window.screenX+(window.innerWidth-400)/2,e=window.screenY+(window.innerHeight-600)/2,window.open("","auth0:authorize:popup",`left=${d},top=${e},width=400,height=600,resizable,scrollbars=yes,status=1`)),!b.popup))throw Error("Unable to open a popup for loginWithPopup - window.open returned `null`");let g=await this._prepareAuthorizeUrl(a.authorizationParams||{},{response_mode:"web_message"},window.location.origin);b.popup.location.href=g.url;let h=await (f=Object.assign(Object.assign({},b),{timeoutInSeconds:b.timeoutInSeconds||this.options.authorizeTimeoutInSeconds||60}),new Promise((a,b)=>{let c,d=setInterval(()=>{f.popup&&f.popup.closed&&(clearInterval(d),clearTimeout(e),window.removeEventListener("message",c,!1),b(new w(f.popup)))},1e3),e=setTimeout(()=>{clearInterval(d),b(new v(f.popup)),window.removeEventListener("message",c,!1)},1e3*(f.timeoutInSeconds||60));c=function(g){if(g.data&&"authorization_response"===g.data.type){if(clearTimeout(e),clearInterval(d),window.removeEventListener("message",c,!1),f.popup.close(),g.data.response.error)return b(r.fromPayload(g.data.response));a(g.data.response)}},window.addEventListener("message",c)}));if(g.state!==h.state)throw new r("state_mismatch","Invalid state");let i=(null==(c=a.authorizationParams)?void 0:c.organization)||this.options.authorizationParams.organization;await this._requestToken({audience:g.audience,scope:g.scope,code_verifier:g.code_verifier,grant_type:"authorization_code",code:h.code,redirect_uri:g.redirect_uri},{nonceIn:g.nonce,organization:i})}async getUser(){var a;let b=await this._getIdTokenFromCache();return null==(a=null==b?void 0:b.decodedToken)?void 0:a.user}async getIdTokenClaims(){var a;let b=await this._getIdTokenFromCache();return null==(a=null==b?void 0:b.decodedToken)?void 0:a.claims}async loginWithRedirect(a={}){var b;let c=ar(a),{openUrl:e,fragment:f,appState:g}=c,h=i(c,["openUrl","fragment","appState"]),j=(null==(b=h.authorizationParams)?void 0:b.organization)||this.options.authorizationParams.organization,k=await this._prepareAuthorizeUrl(h.authorizationParams||{}),{url:l}=k,m=i(k,["url"]);this.transactionManager.create(Object.assign(Object.assign(Object.assign({},m),{appState:g,response_type:d.Code}),j&&{organization:j}));let n=f?`${l}#${f}`:l;e?await e(n):window.location.assign(n)}async handleRedirectCallback(a=window.location.href){var b;let c,e=a.split("?").slice(1);if(0===e.length)throw Error("There are no query params available for parsing.");let f=this.transactionManager.get();if(!f)throw new r("missing_transaction","Invalid state");this.transactionManager.remove();let g=((b=e.join("")).indexOf("#")>-1&&(b=b.substring(0,b.indexOf("#"))),{state:(c=new URLSearchParams(b)).get("state"),code:c.get("code")||void 0,connect_code:c.get("connect_code")||void 0,error:c.get("error")||void 0,error_description:c.get("error_description")||void 0});return f.response_type===d.ConnectCode?this._handleConnectAccountRedirectCallback(g,f):this._handleLoginRedirectCallback(g,f)}async _handleLoginRedirectCallback(a,b){let{code:c,state:e,error:f,error_description:g}=a;if(f)throw new s(f,g||f,e,b.appState);if(!b.code_verifier||b.state&&b.state!==e)throw new r("state_mismatch","Invalid state");let h=b.organization,i=b.nonce,j=b.redirect_uri;return await this._requestToken(Object.assign({audience:b.audience,scope:b.scope,code_verifier:b.code_verifier,grant_type:"authorization_code",code:c},j?{redirect_uri:j}:{}),{nonceIn:i,organization:h}),{appState:b.appState,response_type:d.Code}}async _handleConnectAccountRedirectCallback(a,b){let{connect_code:c,state:e,error:f,error_description:g}=a;if(f)throw new t(f,g||f,b.connection,e,b.appState);if(!c)throw new r("missing_connect_code","Missing connect code");if(!(b.code_verifier&&b.state&&b.auth_session&&b.redirect_uri&&b.state===e))throw new r("state_mismatch","Invalid state");return Object.assign(Object.assign({},await this.myAccountApi.completeAccount({auth_session:b.auth_session,connect_code:c,redirect_uri:b.redirect_uri,code_verifier:b.code_verifier})),{appState:b.appState,response_type:d.ConnectCode})}async checkSession(a){if(!this.cookieStorage.get(this.isAuthenticatedCookieName)){if(!this.cookieStorage.get("auth0.is.authenticated"))return;this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove("auth0.is.authenticated")}try{await this.getTokenSilently(a)}catch(a){}}async getTokenSilently(a={}){var b,c,d,e;let f,g=Object.assign(Object.assign({cacheMode:"on"},a),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),a.authorizationParams),{scope:_(this.scope,null==(b=a.authorizationParams)?void 0:b.scope,(null==(c=a.authorizationParams)?void 0:c.audience)||this.options.authorizationParams.audience)})}),h=await (d=()=>this._getTokenSilently(g),(f=an[e=`${this.options.clientId}::${g.authorizationParams.audience}::${g.authorizationParams.scope}`])||(f=d().finally(()=>{delete an[e],f=null}),an[e]=f),f);return a.detailedResponse?h:null==h?void 0:h.access_token}async _getTokenSilently(a){var b,c;let{cacheMode:d}=a,e=i(a,["cacheMode"]);if("off"!==d){let a=await this._getEntryFromCache({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId,cacheMode:d});if(a)return a}if("cache-only"===d)return;let f=(b=this.options.clientId,c=e.authorizationParams.audience||"default",`auth0.lock.getTokenSilently.${b}.${c}`);if(!await (async(a,b=3)=>{for(let c=0;c<b;c++)if(await a())return!0;return!1})(()=>az.acquireLock(f,5e3),10))throw new u;this.activeLockKeys.add(f),1===this.activeLockKeys.size&&window.addEventListener("pagehide",this._releaseLockOnPageHide);try{if("off"!==d){let a=await this._getEntryFromCache({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId});if(a)return a}let{id_token:a,token_type:b,access_token:c,oauthTokenScope:f,expires_in:g}=this.options.useRefreshTokens?await this._getTokenUsingRefreshToken(e):await this._getTokenFromIFrame(e);return Object.assign(Object.assign({id_token:a,token_type:b,access_token:c},f?{scope:f}:null),{expires_in:g})}finally{await az.releaseLock(f),this.activeLockKeys.delete(f),0===this.activeLockKeys.size&&window.removeEventListener("pagehide",this._releaseLockOnPageHide)}}async getTokenWithPopup(a={},b={}){var c,d;let e=Object.assign(Object.assign({},a),{authorizationParams:Object.assign(Object.assign(Object.assign({},this.options.authorizationParams),a.authorizationParams),{scope:_(this.scope,null==(c=a.authorizationParams)?void 0:c.scope,(null==(d=a.authorizationParams)?void 0:d.audience)||this.options.authorizationParams.audience)})});return b=Object.assign(Object.assign({},o),b),await this.loginWithPopup(e,b),(await this.cacheManager.get(new aa({scope:e.authorizationParams.scope,audience:e.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt)).access_token}async isAuthenticated(){return!!await this.getUser()}_buildLogoutUrl(a){null!==a.clientId?a.clientId=a.clientId||this.options.clientId:delete a.clientId;let b=a.logoutParams||{},{federated:c}=b,d=i(b,["federated"]);return this._url(`/v2/logout?${E(Object.assign({clientId:a.clientId},d))}`)+(c?"&federated":"")}async logout(a={}){var b;let c=ar(a),{openUrl:d}=c,e=i(c,["openUrl"]);null===a.clientId?await this.cacheManager.clear():await this.cacheManager.clear(a.clientId||this.options.clientId),this.cookieStorage.remove(this.orgHintCookieName,{cookieDomain:this.options.cookieDomain}),this.cookieStorage.remove(this.isAuthenticatedCookieName,{cookieDomain:this.options.cookieDomain}),this.userCache.remove("@@user@@"),await (null==(b=this.dpop)?void 0:b.clear());let f=this._buildLogoutUrl(e);d?await d(f):!1!==d&&window.location.assign(f)}async _getTokenFromIFrame(a){let b=Object.assign(Object.assign({},a.authorizationParams),{prompt:"none"}),c=this.cookieStorage.get(this.orgHintCookieName);c&&!b.organization&&(b.organization=c);let{url:d,state:e,nonce:f,code_verifier:g,redirect_uri:h,scope:i,audience:j}=await this._prepareAuthorizeUrl(b,{response_mode:"web_message"},window.location.origin);try{let c;if(window.crossOriginIsolated)throw new r("login_required","The application is running in a Cross-Origin Isolated context, silently retrieving a token without refresh token is not possible.");let k=a.timeoutInSeconds||this.options.authorizeTimeoutInSeconds;try{c=new URL(this.domainUrl).origin}catch(a){c=this.domainUrl}let l=await ((a,b,c=60)=>new Promise((d,e)=>{let f,g=window.document.createElement("iframe");g.setAttribute("width","0"),g.setAttribute("height","0"),g.style.display="none";let h=()=>{window.document.body.contains(g)&&(window.document.body.removeChild(g),window.removeEventListener("message",f,!1))},i=setTimeout(()=>{e(new u),h()},1e3*c);f=function(a){if(a.origin!=b||!a.data||"authorization_response"!==a.data.type)return;let c=a.source;c&&c.close(),a.data.response.error?e(r.fromPayload(a.data.response)):d(a.data.response),clearTimeout(i),window.removeEventListener("message",f,!1),setTimeout(h,2e3)},window.addEventListener("message",f,!1),window.document.body.appendChild(g),g.setAttribute("src",a)}))(d,c,k);if(e!==l.state)throw new r("state_mismatch","Invalid state");let m=await this._requestToken(Object.assign(Object.assign({},a.authorizationParams),{code_verifier:g,code:l.code,grant_type:"authorization_code",redirect_uri:h,timeout:a.authorizationParams.timeout||this.httpTimeoutMs}),{nonceIn:f,organization:b.organization});return Object.assign(Object.assign({},m),{scope:i,oauthTokenScope:m.scope,audience:j})}catch(a){throw"login_required"===a.error&&this.logout({openUrl:!1}),a}}async _getTokenUsingRefreshToken(a){var b,c,d,e,f;let g=await this.cacheManager.get(new aa({scope:a.authorizationParams.scope,audience:a.authorizationParams.audience||"default",clientId:this.options.clientId}),void 0,this.options.useMrrt);if(!(g&&g.refresh_token||this.worker)){if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(a);throw new y(a.authorizationParams.audience||"default",a.authorizationParams.scope)}let h=a.authorizationParams.redirect_uri||this.options.authorizationParams.redirect_uri||window.location.origin,i="number"==typeof a.timeoutInSeconds?1e3*a.timeoutInSeconds:null,j=((a,b,c,d)=>{var e;if(a&&c&&d){if(b.audience!==c)return b.scope;let a=d.split(" "),f=(null==(e=b.scope)?void 0:e.split(" "))||[],g=f.every(b=>a.includes(b));return a.length>=f.length&&g?d:b.scope}return b.scope})(this.options.useMrrt,a.authorizationParams,null==g?void 0:g.audience,null==g?void 0:g.scope);try{let k=await this._requestToken(Object.assign(Object.assign(Object.assign({},a.authorizationParams),{grant_type:"refresh_token",refresh_token:g&&g.refresh_token,redirect_uri:h}),i&&{timeout:i}),{scopesToRequest:j});if(k.refresh_token&&this.options.useMrrt&&(null==g?void 0:g.refresh_token)&&await this.cacheManager.updateEntry(g.refresh_token,k.refresh_token),this.options.useMrrt&&(b=null==g?void 0:g.audience,c=null==g?void 0:g.scope,d=a.authorizationParams.audience,e=a.authorizationParams.scope,b!==d||!as(e,c))&&!as(j,k.scope)){let b,c;if(this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(a);await this.cacheManager.remove(this.options.clientId,a.authorizationParams.audience,a.authorizationParams.scope);let d=(f=k.scope,b=(null==j?void 0:j.split(" "))||[],c=(null==f?void 0:f.split(" "))||[],b.filter(a=>-1==c.indexOf(a)).join(","));throw new z(a.authorizationParams.audience||"default",d)}return Object.assign(Object.assign({},k),{scope:a.authorizationParams.scope,oauthTokenScope:k.scope,audience:a.authorizationParams.audience||"default"})}catch(b){if((b.message.indexOf("Missing Refresh Token")>-1||b.message&&b.message.indexOf("invalid refresh token")>-1)&&this.options.useRefreshTokensFallback)return await this._getTokenFromIFrame(a);throw b}}async _saveEntryInCache(a){let{id_token:b,decodedToken:c}=a,d=i(a,["id_token","decodedToken"]);this.userCache.set("@@user@@",{id_token:b,decodedToken:c}),await this.cacheManager.setIdToken(this.options.clientId,a.id_token,a.decodedToken),await this.cacheManager.set(d)}async _getIdTokenFromCache(){let a=this.options.authorizationParams.audience||"default",b=this.scope[a],c=await this.cacheManager.getIdToken(new aa({clientId:this.options.clientId,audience:a,scope:b})),d=this.userCache.get("@@user@@");return c&&c.id_token===(null==d?void 0:d.id_token)?d:(this.userCache.set("@@user@@",c),c)}async _getEntryFromCache({scope:a,audience:b,clientId:c,cacheMode:d}){let e=await this.cacheManager.get(new aa({scope:a,audience:b,clientId:c}),60,this.options.useMrrt,d);if(e&&e.access_token){let{token_type:a,access_token:b,oauthTokenScope:c,expires_in:d}=e,f=await this._getIdTokenFromCache();return f&&Object.assign(Object.assign({id_token:f.id_token,token_type:a||"Bearer",access_token:b},c?{scope:c}:null),{expires_in:d})}}async _requestToken(a,b){let{nonceIn:c,organization:d,scopesToRequest:e}=b||{},f=await Z(Object.assign(Object.assign({baseUrl:this.domainUrl,client_id:this.options.clientId,auth0Client:this.options.auth0Client,useFormData:this.options.useFormData,timeout:this.httpTimeoutMs,useMrrt:this.options.useMrrt,dpop:this.dpop},a),{scope:e||a.scope}),this.worker),g=await this._verifyIdToken(f.id_token,c,d);return await this._saveEntryInCache(Object.assign(Object.assign(Object.assign(Object.assign({},f),{decodedToken:g,scope:a.scope,audience:a.audience||"default"}),f.scope?{oauthTokenScope:f.scope}:null),{client_id:this.options.clientId})),this.cookieStorage.save(this.isAuthenticatedCookieName,!0,{daysUntilExpire:this.sessionCheckExpiryDays,cookieDomain:this.options.cookieDomain}),this._processOrgHint(d||g.claims.org_id),Object.assign(Object.assign({},f),{decodedToken:g})}async exchangeToken(a){return this._requestToken({grant_type:"urn:ietf:params:oauth:grant-type:token-exchange",subject_token:a.subject_token,subject_token_type:a.subject_token_type,scope:_(this.scope,a.scope,a.audience||this.options.authorizationParams.audience),audience:a.audience||this.options.authorizationParams.audience})}_assertDpop(a){if(!a)throw Error("`useDpop` option must be enabled before using DPoP.")}getDpopNonce(a){return this._assertDpop(this.dpop),this.dpop.getNonce(a)}setDpopNonce(a,b){return this._assertDpop(this.dpop),this.dpop.setNonce(a,b)}generateDpopProof(a){return this._assertDpop(this.dpop),this.dpop.generateProof(a)}createFetcher(a={}){return new aw(a,{isDpopEnabled:()=>!!this.options.useDpop,getAccessToken:a=>{var b;return this.getTokenSilently({authorizationParams:{scope:null==(b=null==a?void 0:a.scope)?void 0:b.join(" "),audience:null==a?void 0:a.audience},detailedResponse:!0})},getDpopNonce:()=>this.getDpopNonce(a.dpopNonceId),setDpopNonce:b=>this.setDpopNonce(b,a.dpopNonceId),generateDpopProof:a=>this.generateDpopProof(a)})}async connectAccountWithRedirect(a){let{openUrl:b,appState:c,connection:e,scopes:f,authorization_params:g,redirectUri:h=this.options.authorizationParams.redirect_uri||window.location.origin}=a;if(!e)throw Error("connection is required");let i=btoa(C()),j=C(),k=H(await F(j)),{connect_uri:l,connect_params:m,auth_session:n}=await this.myAccountApi.connectAccount({connection:e,scopes:f,redirect_uri:h,state:i,code_challenge:k,code_challenge_method:"S256",authorization_params:g});this.transactionManager.create({state:i,code_verifier:j,auth_session:n,redirect_uri:h,appState:c,connection:e,response_type:d.ConnectCode});let o=new URL(l);o.searchParams.set("ticket",m.ticket),b?await b(o.toString()):window.location.assign(o)}}var aB=a.i(49815),aC=a.i(50944),aD=a.i(71716);function aE(){let a=(0,aC.useRouter)(),[b,c]=(0,h.useState)("..."),[d,e]=(0,h.useState)(""),f=(0,aB.createBrowserClient)(),i=(0,h.useRef)(!1);return(0,h.useEffect)(()=>{i.current||(i.current=!0,(async()=>{try{let b=process.env.NEXT_PUBLIC_AUTH0_DOMAIN,d=process.env.NEXT_PUBLIC_AUTH0_CLIENT_ID;if(!b||!d)throw Error("Auth0 configuration missing");console.log("Current URL:",window.location.href);let g=new aA({domain:b,clientId:d,cacheLocation:"localstorage",authorizationParams:{redirect_uri:`${window.location.origin}/auth/callback/auth0`}});console.log("Calling handleRedirectCallback...");let h=await g.handleRedirectCallback();console.log("handleRedirectCallback success",h);let i=h.appState?.invitationToken;console.log("Calling getIdTokenClaims...");let j=await g.getIdTokenClaims(),k=j?.__raw;if(console.log("getIdTokenClaims success"),!k||!j)throw Error("No ID token found");let l=`Issuer: ${j.iss}
Audience: ${j.aud}`;e(l),console.log("ID Token Claims:",j),c(`Supabase...
Issuer: ${j.iss}
Audience: ${j.aud}`);let{data:{session:m},error:n}=await f.auth.signInWithIdToken({provider:"auth0",token:k});if(n)throw Error(`Supabase Sign-In Failed: ${n.message} (Issuer: ${j.iss}, Audience: ${j.aud})`);let o=h.appState?.mode;if("create-store"===o){c("..."),a.push("/onboarding/profile?mode=create");return}if("join-store"===o){c("..."),a.push("/onboarding/select-store");return}if(i){c("...");let a=await (0,aD.acceptInvitation)(i);a.success||(console.error("Invitation accept error:",a.error),alert(": "+a.error))}c("..."),a.push("/app/dashboard")}catch(d){console.error("Callback error:",d);let a=d instanceof Error?d.message:"Unknown error",b=JSON.stringify(d,null,2);c(`: ${a}

Debug InfoIssuerAudienceSupabase

: ${b}`)}})())},[a,f]),(0,g.jsx)("div",{className:"min-h-screen flex flex-col items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:(0,g.jsxs)("div",{className:"text-center space-y-4 max-w-lg w-full",children:[(0,g.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-gray-900 dark:border-white mx-auto"}),(0,g.jsx)("p",{className:"text-lg font-medium text-gray-900 dark:text-white whitespace-pre-wrap break-words",children:b}),d&&(0,g.jsxs)("div",{className:"mt-4 p-4 bg-gray-100 dark:bg-gray-800 rounded text-left text-xs font-mono overflow-auto max-h-40",children:[(0,g.jsx)("p",{className:"font-bold mb-2",children:"Debug Info (Supabase):"}),(0,g.jsx)("pre",{className:"whitespace-pre-wrap break-all",children:d})]})]})})}a.s(["default",()=>aE,"dynamic",0,"force-dynamic"],23446)}];

//# sourceMappingURL=apps_app_src_app_auth_callback_auth0_page_tsx_43b7cd72._.js.map