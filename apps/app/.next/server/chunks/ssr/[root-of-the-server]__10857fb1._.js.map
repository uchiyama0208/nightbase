{"version":3,"sources":["../../../../../../apps/app/src/app/app/%28main%29/users/users-table.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/app/src/app/app/%28main%29/users/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const UsersTable = registerClientReference(\n    function() { throw new Error(\"Attempted to call UsersTable() from the server but UsersTable is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/app/src/app/app/(main)/users/users-table.tsx\",\n    \"UsersTable\",\n);\n","import { Suspense } from \"react\";\nimport type { Metadata } from \"next\";\nimport { redirect } from \"next/navigation\";\nimport { createServerClient } from \"@/lib/supabaseServerClient\";\nimport { UsersTable } from \"./users-table\";\n\nexport const metadata: Metadata = {\n    title: \"プロフィール情報\",\n};\n\nimport { getAppData } from \"../../data-access\";\n\n// Server-side data fetching\nasync function getUsersData(roleParam: string, queryParam: string) {\n    const supabase = await createServerClient();\n    const { user, profile } = await getAppData();\n\n    if (!user) {\n        redirect(\"/login\");\n    }\n\n    if (!profile || !profile.store_id) {\n        redirect(\"/app/me\");\n    }\n\n    const storeId = profile.store_id;\n\n    // Build query\n    let query = supabase\n        .from(\"profiles\")\n        .select(\"*, stores(*)\")\n        .eq(\"store_id\", storeId)\n        .order(\"created_at\", { ascending: false });\n\n    // Filter by role\n    const normalizedRole = roleParam.toLowerCase();\n    if (normalizedRole && [\"cast\", \"staff\", \"guest\"].includes(normalizedRole)) {\n        if (normalizedRole === \"staff\") {\n            query = query.in(\"role\", [\"staff\", \"admin\"]);\n        } else {\n            query = query.eq(\"role\", normalizedRole);\n        }\n    } else {\n        query = query.eq(\"role\", \"cast\");\n    }\n\n    // Filter by search query\n    if (queryParam) {\n        query = query.or(\n            `display_name.ilike.%${queryParam}%,real_name.ilike.%${queryParam}%`\n        );\n    }\n\n    const { data: profiles, error } = await query;\n\n    if (error) {\n        console.error(\"Error fetching profiles:\", error);\n        throw new Error(error.message);\n    }\n\n    return {\n        profiles: profiles || [],\n        role: normalizedRole || \"cast\",\n    };\n}\n\nfunction UsersSkeleton() {\n    return (\n        <div className=\"space-y-4 animate-pulse\">\n            <div className=\"h-8 w-1/3 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n            <div className=\"h-4 w-1/2 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n            <div className=\"h-64 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n        </div>\n    );\n}\n\n// Server Component\nexport default async function UsersPage({\n    searchParams,\n}: {\n    searchParams: Promise<{ role?: string; query?: string }>;\n}) {\n    const params = await searchParams;\n    const roleParam = params.role || \"cast\";\n    const queryParam = params.query || \"\";\n\n    const data = await getUsersData(roleParam, queryParam);\n    const { profiles, role } = data;\n\n    return (\n        <div className=\"space-y-4\">\n            <div>\n                <h1 className=\"text-xl md:text-2xl font-bold tracking-tight text-gray-900 dark:text-white\">プロフィール情報</h1>\n                <p className=\"text-xs md:text-sm text-muted-foreground dark:text-gray-400\">\n                    キャスト・スタッフ・ゲストのプロフィールを管理します。\n                </p>\n            </div>\n\n            <Suspense fallback={<UsersSkeleton />}>\n                <UsersTable profiles={profiles} roleFilter={role} />\n            </Suspense>\n        </div>\n    );\n}\n\n// Force dynamic rendering\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n"],"names":[],"mappings":"+VAEO,IAAM,EAAa,CAAA,EAAA,AAD1B,EAAA,CAAA,CAAA,OAC0B,uBAAA,AAAuB,EAC7C,WAAa,MAAM,AAAI,MAAM,kOAAoO,EACjQ,kFACA,8DAHG,IAAM,EAAa,CAAA,EAD1B,AAC0B,EAD1B,CAAA,CAAA,OAC0B,uBAAA,AAAuB,EAC7C,WAAa,MAAM,AAAI,MAAM,kOAAoO,EACjQ,8DACA,wICLJ,EAAA,EAAA,CAAA,CAAA,KAEA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAMA,EAAA,EAAA,CAAA,CAAA,OAGA,eAAe,EAAa,CAAiB,CAAE,CAAkB,EAC7D,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IACnC,MAAE,CAAI,SAAE,CAAO,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,GAEtC,CAAC,GACD,CAAA,EADO,AACP,EAAA,QAAA,AAAQ,EAAC,UAGT,AAAC,GAAY,EAAQ,MAAT,EAAiB,EAC7B,AAD+B,AAC/B,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,WAGb,IAAM,EAAU,EAAQ,QAAQ,CAG5B,EAAQ,EACP,IAAI,CAAC,YACL,MAAM,CAAC,gBACP,EAAE,CAAC,WAAY,GACf,KAAK,CAAC,aAAc,CAAE,WAAW,CAAM,GAGtC,EAAiB,EAAU,WAAW,GAGpC,EAFJ,GAAkB,CAAC,OAAQ,QAAS,QAAQ,CAAC,QAAQ,CAAC,GAC/B,SAAS,CAA5B,EACQ,EAF2D,AAErD,EAAE,CAAC,OAAQ,CAAC,QAAS,QAAQ,EAEnC,EAAM,EAAE,CAAC,OAAQ,GAGrB,EAAM,EAAE,CAAC,OAAQ,QAIzB,IACA,EAAQ,EAAM,EAAE,CACZ,CAFQ,AAEP,oBAAoB,EAAE,EAAW,mBAAmB,EAAE,EAAW,CAAC,EAAC,EAI5E,GAAM,CAAE,KAAM,CAAQ,CAAE,OAAK,CAAE,CAAG,MAAM,EAExC,GAAI,EAEA,KAFO,CACP,QAAQ,KAAK,CAAC,2BAA4B,GAChC,AAAJ,MAAU,EAAM,OAAO,EAGjC,MAAO,CACH,SAAU,GAAY,EAAE,CACxB,KAAM,GAAkB,MAC5B,CACJ,CAEA,SAAS,IACL,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gDAG3B,CAGe,eAAe,EAAU,cACpC,CAAY,CAGf,EACG,IAAM,EAAS,MAAM,EACf,EAAY,EAAO,IAAI,EAAI,OAC3B,EAAa,EAAO,KAAK,EAAI,GAG7B,UAAE,CAAQ,MAAE,CAAI,CAAE,CADX,EACc,IADR,EAAa,EAAW,GAG3C,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,sBACX,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,WACG,CAAA,EAAA,EAAA,GAAA,EAAC,KAAA,CAAG,UAAU,sFAA6E,aAC3F,CAAA,EAAA,EAAA,GAAA,EAAC,IAAA,CAAE,UAAU,uEAA8D,mCAK/E,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,SAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,YACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,UAAU,CAAA,CAAC,SAAU,EAAU,WAAY,QAI5D,kCAGuB,6BApGW,CAC9B,MAAO,UACX,iBAmG0B","ignoreList":[0]}