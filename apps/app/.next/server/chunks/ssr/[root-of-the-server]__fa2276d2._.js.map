{"version":3,"sources":["../../../../../../apps/app/src/app/app/%28main%29/roles/roles-client.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/app/src/app/app/%28main%29/roles/page.tsx"],"sourcesContent":["// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const RolesPageClient = registerClientReference(\n    function() { throw new Error(\"Attempted to call RolesPageClient() from the server but RolesPageClient is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/app/src/app/app/(main)/roles/roles-client.tsx\",\n    \"RolesPageClient\",\n);\n","import { Suspense } from \"react\";\nimport type { Metadata } from \"next\";\nimport { redirect } from \"next/navigation\";\nimport { createServerClient } from \"@/lib/supabaseServerClient\";\nimport { RolesPageClient } from \"./roles-client\";\n\nexport const metadata: Metadata = {\n    title: \"権限管理\",\n};\n\nasync function getRolesData() {\n    const supabase = await createServerClient();\n    const { data: { user } } = await supabase.auth.getUser();\n\n    if (!user) {\n        redirect(\"/login\");\n    }\n\n    const { data: appUser } = await supabase\n        .from(\"users\")\n        .select(\"current_profile_id\")\n        .eq(\"id\", user.id)\n        .maybeSingle();\n\n    if (!appUser?.current_profile_id) {\n        redirect(\"/app/me\");\n    }\n\n    const { data: currentProfile } = await supabase\n        .from(\"profiles\")\n        .select(\"store_id, role\")\n        .eq(\"id\", appUser.current_profile_id)\n        .maybeSingle();\n\n    if (!currentProfile?.store_id) {\n        redirect(\"/app/me\");\n    }\n\n    if (currentProfile.role !== \"staff\") {\n        redirect(\"/app/dashboard\");\n    }\n\n    const { data: roles } = await supabase\n        .from(\"store_roles\")\n        .select(\"*\")\n        .eq(\"store_id\", currentProfile.store_id)\n        .order(\"created_at\", { ascending: true });\n\n    const { data: profiles } = await supabase\n        .from(\"profiles\")\n        .select(\"id, display_name, real_name, role_id\")\n        .eq(\"store_id\", currentProfile.store_id);\n\n    return {\n        roles: roles || [],\n        profiles: profiles || [],\n    };\n}\n\nfunction RolesSkeleton() {\n    return (\n        <div className=\"space-y-4 animate-pulse\">\n            <div className=\"h-8 w-1/3 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n            <div className=\"h-64 bg-gray-200 dark:bg-gray-700 rounded\"></div>\n        </div>\n    );\n}\n\nexport default async function RolesPage() {\n    const data = await getRolesData();\n\n    return (\n        <Suspense fallback={<RolesSkeleton />}>\n            <RolesPageClient roles={data.roles} profiles={data.profiles} />\n        </Suspense>\n    );\n}\n\nexport const dynamic = 'force-dynamic';\nexport const revalidate = 0;\n"],"names":[],"mappings":"8VAEO,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,mFACA,wEAHG,IAAM,EAAkB,CAAA,EAAA,AAD/B,EAAA,CAAA,CAAA,OAC+B,uBAAA,AAAuB,EAClD,WAAa,MAAM,AAAI,MAAM,4OAA8O,EAC3Q,+DACA,kJCLJ,EAAA,EAAA,CAAA,CAAA,KAEA,EAAA,CAAA,CAAA,OAAA,IAAA,EAAA,EAAA,CAAA,CAAA,OACA,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAMA,eAAe,IACX,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IACnC,CAAE,KAAM,MAAE,CAAI,CAAE,CAAE,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,EAElD,CAAC,GACD,CAAA,EAAA,AADO,EACP,QAAA,AAAQ,EAAC,UAGb,GAAM,CAAE,KAAM,CAAO,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,SACL,MAAM,CAAC,sBACP,EAAE,CAAC,KAAM,EAAK,EAAE,EAChB,WAAW,EAEZ,CAAC,GAAS,oBAAoB,AAC9B,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,WAGb,GAAM,CAAE,KAAM,CAAc,CAAE,CAAG,MAAM,EAClC,IAAI,CAAC,YACL,MAAM,CAAC,kBACP,EAAE,CAAC,KAAM,EAAQ,kBAAkB,EACnC,WAAW,EAEZ,CAAC,GAAgB,UAAU,AAC3B,CAAA,EAAA,EAAA,QAAA,AAAQ,EAAC,WAGe,SAAS,CAAjC,EAAe,IAAI,EACnB,CAAA,EAAA,EAAA,QAAQ,AAAR,EAAS,kBAGb,GAAM,CAAE,KAAM,CAAK,CAAE,CAAG,MAAM,EACzB,IAAI,CAAC,eACL,MAAM,CAAC,KACP,EAAE,CAAC,WAAY,EAAe,QAAQ,EACtC,KAAK,CAAC,aAAc,CAAE,WAAW,CAAK,GAErC,CAAE,KAAM,CAAQ,CAAE,CAAG,MAAM,EAC5B,IAAI,CAAC,YACL,MAAM,CAAC,wCACP,EAAE,CAAC,WAAY,EAAe,QAAQ,EAE3C,MAAO,CACH,MAAO,GAAS,EAAE,CAClB,SAAU,GAAY,EAAE,AAC5B,CACJ,CAEA,SAAS,IACL,MACI,CAAA,EAAA,EAAA,IAAA,EAAC,MAAA,CAAI,UAAU,oCACX,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,mDACf,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,gDAG3B,CAEe,eAAe,IAC1B,IAAM,EAAO,MAAM,IAEnB,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,QAAQ,CAAA,CAAC,SAAU,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,CAAA,YACjB,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,eAAe,CAAA,CAAC,MAAO,EAAK,KAAK,CAAE,SAAU,EAAK,QAAQ,IAGvE,kCAEuB,6BAxEW,CAC9B,MAAO,MACX,iBAuE0B","ignoreList":[0]}