module.exports=[3271,a=>{"use strict";var b=a.i(87924),c=a.i(71987),d=a.i(72131),e=a.i(5050),f=(0,e.createServerReference)("40c6ac2758dfc3a203b0445eadd0044237a7643d08",e.callServer,void 0,e.findSourceMapURL,"cancelInvitation"),g=a.i(45750),h=a.i(92772),i=a.i(27534),j=a.i(62403),k=a.i(11520),l=a.i(15618),m=a.i(87532),n=(0,e.createServerReference)("407f73d041bbeb8a449b1a11854978deb1f2bd26db",e.callServer,void 0,e.findSourceMapURL,"createInvitation"),o=a.i(11587),p=a.i(2783),q=a.i(55054),r=a.i(5151),s=a.i(33441),t=a.i(18697);function u({open:a,onOpenChange:e,uninvitedProfiles:f,roles:i}){let[k,m]=(0,d.useState)("form"),[u,v]=(0,d.useState)(!1),[w,x]=(0,d.useState)(""),[y,z]=(0,d.useState)("none"),[A,B]=(0,d.useState)("7"),[C,D]=(0,d.useState)(""),[E,F]=(0,d.useState)(!1),[G,H]=(0,d.useState)(""),[I,J]=(0,d.useState)(!1),[K,L]=(0,d.useState)(!1),M=async a=>{if(a.preventDefault(),w){v(!0);try{let a=await n({profileId:w,roleId:"none"===y?void 0:y,expiresInDays:parseInt(A),password:E?C:void 0});if(a.success&&a.invitation){let b=`${window.location.origin}/invite/${a.invitation.token}`;H(b),m("result")}}catch(a){console.error(a),alert("招待の作成に失敗しました")}finally{v(!1)}}},N=()=>{e(!1),setTimeout(()=>{m("form"),x(""),z("none"),B("7"),D(""),F(!1),H("")},300)};return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(o.Dialog,{open:a&&!K,onOpenChange:N,children:(0,b.jsxs)(o.DialogContent,{className:"max-w-[calc(100vw-32px)] max-h-[calc(100vh-32px)] overflow-y-auto sm:max-w-[500px] bg-white dark:bg-gray-800 text-gray-900 dark:text-white !p-4 sm:!p-6 my-4",children:[(0,b.jsxs)(o.DialogHeader,{children:[(0,b.jsx)(o.DialogTitle,{className:"text-black dark:text-white",children:"form"===k?"ユーザーを招待":"招待リンクを作成しました"}),(0,b.jsx)(o.DialogDescription,{children:"form"===k?"招待するプロフィールと条件を設定してください。":"以下のリンクをユーザーに共有してください。"})]}),"form"===k?(0,b.jsxs)("form",{onSubmit:M,className:"space-y-4 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)(p.Label,{children:"プロフィール選択"}),(0,b.jsxs)("button",{type:"button",onClick:()=>L(!0),className:"text-xs text-blue-600 dark:text-blue-400 flex items-center gap-1 hover:underline",children:[(0,b.jsx)(l.Plus,{className:"h-3 w-3"}),"新しいプロフィールを作成"]})]}),(0,b.jsxs)(j.Select,{value:w,onValueChange:x,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"招待するプロフィールを選択"})}),(0,b.jsx)(j.SelectContent,{children:f.map(a=>(0,b.jsxs)(j.SelectItem,{value:a.id,children:[a.display_name," (","cast"===a.role?"キャスト":"スタッフ",")"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"付与するロール (任意)"}),(0,b.jsxs)(j.Select,{value:y,onValueChange:z,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"ロールを選択 (なし)"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"none",children:"なし (デフォルト権限)"}),i.map(a=>(0,b.jsx)(j.SelectItem,{value:a.id,children:a.name},a.id))]})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"有効期限"}),(0,b.jsxs)(j.Select,{value:A,onValueChange:B,children:[(0,b.jsx)(j.SelectTrigger,{children:(0,b.jsx)(j.SelectValue,{placeholder:"有効期限を選択"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"1",children:"1日"}),(0,b.jsx)(j.SelectItem,{value:"3",children:"3日"}),(0,b.jsx)(j.SelectItem,{value:"7",children:"1週間"}),(0,b.jsx)(j.SelectItem,{value:"30",children:"30日"})]})]})]}),(0,b.jsxs)("div",{className:"space-y-4 pt-2",children:[(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(q.Checkbox,{id:"use-password",checked:E,onCheckedChange:a=>F(a)}),(0,b.jsx)(p.Label,{htmlFor:"use-password",children:"パスワードを設定する"})]}),E&&(0,b.jsx)(h.Input,{type:"password",placeholder:"パスワードを入力",value:C,onChange:a=>D(a.target.value),required:E})]}),(0,b.jsxs)(o.DialogFooter,{className:"pt-4 gap-4",children:[(0,b.jsx)(g.Button,{type:"button",variant:"outline",onClick:N,children:"キャンセル"}),(0,b.jsx)(g.Button,{type:"submit",disabled:u||!w,children:u?"作成中...":"招待リンクを作成"})]})]}):(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"招待リンク"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Input,{readOnly:!0,value:G,className:"font-mono text-sm"}),(0,b.jsx)(g.Button,{type:"button",size:"icon",variant:"outline",onClick:()=>{navigator.clipboard.writeText(G),J(!0),setTimeout(()=>J(!1),2e3)},children:I?(0,b.jsx)(s.Check,{className:"h-4 w-4"}):(0,b.jsx)(r.Copy,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(c.default,{src:`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(G)}`,alt:"招待QRコード",className:"border rounded-lg p-2",width:150,height:150,unoptimized:!0})}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(g.Button,{type:"button",className:"w-full bg-[#06C755] hover:bg-[#05b54b] text-white",onClick:()=>window.open(`https://line.me/R/msg/text/?${encodeURIComponent(`招待リンクをお送りします。
${G}`)}`,"_blank"),children:"LINEで送る"}),(0,b.jsx)(g.Button,{type:"button",variant:"outline",className:"w-full",onClick:N,children:"閉じる"})]})]})]})}),(0,b.jsx)(t.UserEditModal,{open:K,onOpenChange:L,profile:null,isNested:!0})]})}let v=(0,a.i(70106).default)("Ban",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m4.9 4.9 14.2 14.2",key:"1m5liu"}]]);var w=a.i(13749),x=a.i(56711),y=a.i(2411);function z({invitation:a,open:e,onOpenChange:i,onCancel:j}){let[l,m]=(0,d.useState)(!1),[n,q]=(0,d.useTransition)();if(!a)return null;let t=`${window.location.origin}/invite/${a.token}`,u=new Date(a.expires_at)<new Date&&"pending"===a.status,z="pending"===a.status&&!u,A=async()=>{confirm("本当にこの招待をキャンセルしますか？")&&q(async()=>{try{await f(a.id),j&&j(),i(!1)}catch(a){alert("キャンセルに失敗しました")}})};return(0,b.jsx)(o.Dialog,{open:e,onOpenChange:i,children:(0,b.jsxs)(o.DialogContent,{className:"max-w-[calc(100vw-32px)] sm:max-w-[400px] max-h-[calc(100vh-32px)] overflow-y-auto bg-white dark:bg-gray-800 text-gray-900 dark:text-white",children:[(0,b.jsxs)(o.DialogHeader,{children:[(0,b.jsxs)("div",{className:"relative flex items-center justify-center py-2",children:[(0,b.jsx)("button",{onClick:()=>i(!1),className:"absolute left-0 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",children:(0,b.jsx)(w.ChevronLeft,{className:"h-5 w-5 text-gray-500"})}),(0,b.jsx)(o.DialogTitle,{className:"text-black dark:text-white",children:"招待詳細"})]}),(0,b.jsx)(o.DialogDescription,{children:"招待のステータスや詳細を確認できます。"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(p.Label,{className:"text-xs text-muted-foreground",children:"招待プロフィール"}),(0,b.jsxs)("div",{className:"font-medium flex items-center gap-2",children:[a.profile?.avatar_url&&(0,b.jsx)(c.default,{src:a.profile.avatar_url,alt:`${a.profile.display_name}のアバター`,className:"rounded-full object-cover",width:24,height:24}),a.profile?.display_name]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(p.Label,{className:"text-xs text-muted-foreground",children:"ロール"}),(0,b.jsxs)("div",{className:"font-medium",children:[a.profile?.role==="cast"?"キャスト":"スタッフ",a.role&&"staff"!==a.role.name&&"cast"!==a.role.name&&"スタッフ"!==a.role.name&&"キャスト"!==a.role.name&&(0,b.jsxs)("span",{className:"text-sm text-gray-500 ml-1",children:["(",a.role.name,")"]})]})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(p.Label,{className:"text-xs text-muted-foreground",children:"ステータス"}),(0,b.jsx)("div",{children:"canceled"===a.status?(0,b.jsx)(k.Badge,{variant:"destructive",children:"キャンセル"}):"accepted"===a.status?(0,b.jsx)(k.Badge,{className:"bg-green-500",children:"参加済み"}):u?(0,b.jsx)(k.Badge,{variant:"secondary",children:"期限切れ"}):(0,b.jsx)(k.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"招待中"})})]}),(0,b.jsxs)("div",{className:"space-y-1",children:[(0,b.jsx)(p.Label,{className:"text-xs text-muted-foreground",children:"有効期限"}),(0,b.jsx)("div",{className:"font-medium",children:(0,x.format)(new Date(a.expires_at),"yyyy/MM/dd HH:mm",{locale:y.ja})})]})]}),"pending"===a.status&&!u&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(p.Label,{children:"招待リンク"}),(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)(h.Input,{readOnly:!0,value:t,className:"font-mono text-sm"}),(0,b.jsx)(g.Button,{type:"button",size:"icon",variant:"outline",onClick:()=>{navigator.clipboard.writeText(t),m(!0),setTimeout(()=>m(!1),2e3)},children:l?(0,b.jsx)(s.Check,{className:"h-4 w-4"}):(0,b.jsx)(r.Copy,{className:"h-4 w-4"})})]})]}),(0,b.jsx)("div",{className:"flex justify-center",children:(0,b.jsx)(c.default,{src:`https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodeURIComponent(t)}`,alt:"招待QRコード",className:"border rounded-lg p-2",width:150,height:150,unoptimized:!0})}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsx)(g.Button,{type:"button",className:"w-full bg-[#06C755] hover:bg-[#05b54b] text-white",onClick:()=>window.open(`https://line.me/R/msg/text/?${encodeURIComponent(`招待リンクをお送りします。
${t}`)}`,"_blank"),children:"LINEで共有"}),z&&(0,b.jsxs)(g.Button,{type:"button",variant:"destructive",onClick:A,disabled:n,className:"w-full",children:[(0,b.jsx)(v,{className:"mr-2 h-4 w-4"}),"招待をキャンセル"]})]})]}),(0,b.jsx)(g.Button,{type:"button",variant:"outline",className:"w-full",onClick:()=>i(!1),children:"閉じる"})]})]})})}function A({initialInvitations:a,uninvitedProfiles:e,roles:f}){let[n,o]=(0,d.useState)(a),[p,q]=(0,d.useState)(""),[r,s]=(0,d.useState)("all"),[t,v]=(0,d.useState)("all"),[w,A]=(0,d.useState)(!1),[B,C]=(0,d.useTransition)(),[D,E]=(0,d.useState)(null),[F,G]=(0,d.useState)(null),[H,I]=(0,d.useState)(!1),J=n.filter(a=>{let b=(a.profile?.display_name||"").toLowerCase().includes(p.toLowerCase()),c="all"===r||a.status===r,d="all"===t||a.profile?.role===t;return b&&c&&d});return(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,b.jsxs)("div",{className:"relative flex-1",children:[(0,b.jsx)(m.Search,{className:"absolute left-2.5 top-2.5 h-4 w-4 text-muted-foreground"}),(0,b.jsx)(h.Input,{placeholder:"名前で検索...",value:p,onChange:a=>q(a.target.value),className:"pl-8 bg-white dark:bg-gray-800"})]}),(0,b.jsxs)(j.Select,{value:r,onValueChange:s,children:[(0,b.jsx)(j.SelectTrigger,{className:"w-[130px] sm:w-[180px] bg-white dark:bg-gray-800",children:(0,b.jsx)(j.SelectValue,{placeholder:"ステータス"})}),(0,b.jsxs)(j.SelectContent,{children:[(0,b.jsx)(j.SelectItem,{value:"all",children:"全て"}),(0,b.jsx)(j.SelectItem,{value:"pending",children:"招待中"}),(0,b.jsx)(j.SelectItem,{value:"accepted",children:"参加済み"}),(0,b.jsx)(j.SelectItem,{value:"canceled",children:"キャンセル"}),(0,b.jsx)(j.SelectItem,{value:"expired",children:"期限切れ"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-row justify-between items-center",children:[(0,b.jsxs)("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-800 p-1 rounded-full overflow-x-auto max-w-[calc(100%-50px)]",children:[(0,b.jsx)("button",{onClick:()=>v("all"),className:`px-3 sm:px-4 py-1.5 text-xs sm:text-sm rounded-full whitespace-nowrap transition-all ${"all"===t?"bg-white dark:bg-gray-700 shadow-sm font-medium":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"全て"}),(0,b.jsx)("button",{onClick:()=>v("cast"),className:`px-3 sm:px-4 py-1.5 text-xs sm:text-sm rounded-full whitespace-nowrap transition-all ${"cast"===t?"bg-white dark:bg-gray-700 shadow-sm font-medium":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"キャスト"}),(0,b.jsx)("button",{onClick:()=>v("staff"),className:`px-3 sm:px-4 py-1.5 text-xs sm:text-sm rounded-full whitespace-nowrap transition-all ${"staff"===t?"bg-white dark:bg-gray-700 shadow-sm font-medium":"text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200"}`,children:"スタッフ"})]}),(0,b.jsx)(g.Button,{onClick:()=>A(!0),size:"icon",className:"rounded-full w-10 h-10 bg-blue-600 hover:bg-blue-700 shrink-0",children:(0,b.jsx)(l.Plus,{className:"h-5 w-5"})})]})]}),(0,b.jsx)("div",{className:"rounded-md border bg-white dark:bg-gray-800",children:(0,b.jsxs)(i.Table,{children:[(0,b.jsx)(i.TableHeader,{children:(0,b.jsxs)(i.TableRow,{children:[(0,b.jsx)(i.TableHead,{className:"text-center w-1/3",children:"名前"}),(0,b.jsx)(i.TableHead,{className:"text-center w-1/3",children:"ステータス"}),(0,b.jsx)(i.TableHead,{className:"text-center w-1/3",children:"有効期限"})]})}),(0,b.jsx)(i.TableBody,{children:0===J.length?(0,b.jsx)(i.TableRow,{children:(0,b.jsx)(i.TableCell,{colSpan:3,className:"text-center py-8 text-gray-500",children:"招待が見つかりません"})}):J.map(a=>{var d;let e;return(0,b.jsxs)(i.TableRow,{className:"cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800/50",onClick:()=>{G(a),I(!0)},children:[(0,b.jsx)(i.TableCell,{className:"font-medium text-center w-1/3",children:(0,b.jsxs)("div",{className:"flex items-center justify-center gap-2",children:[a.profile?.avatar_url&&(0,b.jsx)(c.default,{src:a.profile.avatar_url,alt:`${a.profile.display_name}のアバター`,className:"rounded-full object-cover",width:24,height:24}),a.profile?.display_name]})}),(0,b.jsx)(i.TableCell,{className:"text-center w-1/3",children:(0,b.jsx)("div",{className:"flex justify-center",children:(d=a.status,e=new Date(a.expires_at)<new Date&&"pending"===d,"canceled"===d?(0,b.jsx)(k.Badge,{variant:"destructive",children:"キャンセル"}):"accepted"===d?(0,b.jsx)(k.Badge,{className:"bg-green-500",children:"参加済み"}):e?(0,b.jsx)(k.Badge,{variant:"secondary",children:"期限切れ"}):(0,b.jsx)(k.Badge,{variant:"outline",className:"bg-blue-50 text-blue-700 border-blue-200",children:"招待中"}))})}),(0,b.jsx)(i.TableCell,{className:"text-sm text-gray-500 text-center w-1/3",children:"accepted"===a.status?"ー":(0,x.format)(new Date(a.expires_at),"yyyy/MM/dd HH:mm",{locale:y.ja})})]},a.id)})})]})}),(0,b.jsx)(u,{open:w,onOpenChange:A,uninvitedProfiles:e,roles:f}),(0,b.jsx)(z,{invitation:F,open:H,onOpenChange:I,onCancel:()=>{F&&(o(a=>a.map(a=>a.id===F.id?{...a,status:"canceled"}:a)),G(a=>a?{...a,status:"canceled"}:null))}})]})}a.s(["InvitationList",()=>A],3271)}];

//# sourceMappingURL=apps_app_src_app_app_%28main%29_invitations_invitation-list_tsx_662047ef._.js.map