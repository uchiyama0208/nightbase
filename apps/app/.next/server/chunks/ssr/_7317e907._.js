module.exports=[92372,a=>{"use strict";var b=a.i(37936),c=a.i(9480),d=a.i(18558);async function e(a){let b=await (0,c.createServerClient)(),{data:d,error:e}=await b.from("stores").select("id, name, industry, prefecture, allow_join_requests").eq("id",a).maybeSingle();return e||!d?{success:!1,error:"店舗が見つかりませんでした"}:d.allow_join_requests?{success:!0,store:d}:{success:!1,error:"この店舗は参加申請を受け付けていません"}}async function f(a){let b=await (0,c.createServerClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)return{success:!1,error:"Unauthorized"};let g=a.get("display_name"),h=a.get("display_name_kana"),i=a.get("real_name"),j=a.get("real_name_kana"),k=a.get("store_id"),l=a.get("role"),{data:m,error:n}=await b.from("profiles").insert({user_id:e.id,store_id:k,display_name:g,display_name_kana:h,real_name:i,real_name_kana:j,role:l,approval_status:"pending"}).select().single();return n?(console.error("Profile creation error:",n),{success:!1,error:n.message}):(await b.from("users").update({current_profile_id:m.id}).eq("id",e.id),(0,d.revalidatePath)("/"),{success:!0,profileId:m.id})}async function g(){let a=await (0,c.createServerClient)(),{data:{user:b},error:d}=await a.auth.getUser();if(d||!b)return{success:!1,error:"Unauthorized"};let{data:e}=await a.from("users").select("current_profile_id").eq("id",b.id).maybeSingle();if(!e?.current_profile_id)return{success:!1,status:null};let{data:f}=await a.from("profiles").select("approval_status, store_id, stores(name)").eq("id",e.current_profile_id).maybeSingle();return f?{success:!0,status:f.approval_status,storeName:f.stores?.name}:{success:!1,status:null}}async function h(a){let b=await (0,c.createServerClient)(),{data:{user:e},error:f}=await b.auth.getUser();if(f||!e)return{success:!1,error:"Unauthorized"};let g=a.get("display_name"),h=a.get("display_name_kana"),i=a.get("real_name"),j=a.get("real_name_kana"),{data:k,error:l}=await b.from("profiles").insert({user_id:e.id,display_name:g,display_name_kana:h,real_name:i,real_name_kana:j,role:"cast"}).select().single();return l?(console.error("Profile creation error:",l),{success:!1,error:l.message}):(await b.from("users").update({current_profile_id:k.id}).eq("id",e.id),(0,d.revalidatePath)("/"),{success:!0,profileId:k.id})}async function i(a){let b,e=await (0,c.createServerClient)(),{data:{user:f},error:g}=await e.auth.getUser();if(g||!f)return{success:!1,error:"Unauthorized"};let h=a.get("display_name"),i=a.get("display_name_kana"),j=a.get("real_name"),k=a.get("real_name_kana"),{data:l}=await e.from("profiles").select("id").eq("user_id",f.id).maybeSingle();if(l){let{error:a}=await e.from("profiles").update({display_name:h,display_name_kana:i,real_name:j,real_name_kana:k,role:"staff"}).eq("id",l.id);if(a)return console.error("Profile update error:",a),{success:!1,error:a.message};b=l.id}else{let{data:a,error:c}=await e.from("profiles").insert({user_id:f.id,display_name:h,display_name_kana:i,real_name:j,real_name_kana:k,role:"staff"}).select().single();if(c)return console.error("Profile creation error:",c),{success:!1,error:c.message};b=a.id}return await e.from("users").update({current_profile_id:b}).eq("id",f.id),(0,d.revalidatePath)("/"),{success:!0,profileId:b}}async function j(b){let e=await (0,c.createServerClient)(),{data:{user:f},error:g}=await e.auth.getUser();if(g||!f)return{success:!1,error:"Unauthorized"};let{data:h}=await e.from("users").select("current_profile_id").eq("id",f.id).maybeSingle();if(!h?.current_profile_id)return{success:!1,error:"Profile not found"};let i=b.get("name"),j=b.get("industry"),k=b.get("prefecture"),l=b.get("business_start_time"),m=b.get("business_end_time"),n=b.get("day_switch_time"),o=b.getAll("closed_days"),p=b.get("referral_source"),{data:q,error:r}=await e.from("stores").insert({name:i,industry:j,prefecture:k,business_start_time:l,business_end_time:m,day_switch_time:n,closed_days:o,referral_source:p}).select().single();if(r)return console.error("Store creation error:",r),{success:!1,error:r.message};let{createClient:s}=await a.A(89492),t=s(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE_KEY),{data:u,error:v}=await t.from("store_roles").insert({store_id:q.id,name:"スタッフ",permissions:{can_manage_roles:!0,can_manage_users:!0,can_manage_settings:!0},is_system_role:!0}).select().single();if(v||!u)return console.error("Failed to create Staff role:",v),await e.from("stores").delete().eq("id",q.id),{success:!1,error:"デフォルトロールの作成に失敗しました"};let{data:w,error:x}=await t.from("store_roles").insert({store_id:q.id,name:"キャスト",permissions:{},is_system_role:!0}).select().single();if(x||!w)return console.error("Failed to create Cast role:",x),await e.from("stores").delete().eq("id",q.id),{success:!1,error:"デフォルトロールの作成に失敗しました"};let{error:y}=await e.from("profiles").update({store_id:q.id,role_id:u.id}).eq("id",h.current_profile_id);return y?(console.error("Profile update error:",y),await e.from("stores").delete().eq("id",q.id),{success:!1,error:y.message}):((0,d.revalidatePath)("/"),{success:!0,storeId:q.id})}async function k(){let a=await (0,c.createServerClient)(),{data:{user:b},error:d}=await a.auth.getUser();if(d||!b)return{hasProfile:!1,hasStore:!1};let{data:e}=await a.from("users").select("current_profile_id").eq("id",b.id).maybeSingle();if(!e?.current_profile_id)return{hasProfile:!1,hasStore:!1};let{data:f}=await a.from("profiles").select("id, store_id").eq("id",e.current_profile_id).maybeSingle();return{hasProfile:!!f,hasStore:!!f?.store_id,profileId:f?.id}}async function l(a){let b=await (0,c.createServerClient)(),{data:{user:d},error:e}=await b.auth.getUser();return e||!d?{success:!1,error:"Unauthorized"}:{success:!0,data:{display_name:a.get("display_name"),display_name_kana:a.get("display_name_kana"),real_name:a.get("real_name"),real_name_kana:a.get("real_name_kana"),mode:a.get("mode")}}}(0,a.i(13095).ensureServerEntryExports)([e,f,g,h,i,j,k,l]),(0,b.registerServerReference)(e,"40476d16bfafc941e42391cd6c61fd29fb45bf7ba8",null),(0,b.registerServerReference)(f,"40faf807e06574d53c4c696d08a733443a98ee2663",null),(0,b.registerServerReference)(g,"007459db64f988141da28e810b38601e5e8829989c",null),(0,b.registerServerReference)(h,"40b9a39c79ec9950ce844ec6bfa81e1ac65a07a7ae",null),(0,b.registerServerReference)(i,"4027b1192d2a5824e24c2341670dd47bd59a9d9dd1",null),(0,b.registerServerReference)(j,"40d5fe78616dc84ed84bb024ebbfa70e8272364ded",null),(0,b.registerServerReference)(k,"00a366f58867cd9464c3516abbd5c26eaae1e12245",null),(0,b.registerServerReference)(l,"4031e7d19aab9a55f7b0797853fc65ef891aa0ab29",null),a.s(["checkApprovalStatus",()=>g,"createPendingProfile",()=>f,"createProfileOnly",()=>h,"createStoreAndLink",()=>j,"getOnboardingStatus",()=>k,"saveProfileData",()=>l,"searchStore",()=>e,"upsertOwnerProfile",()=>i])},77017,a=>{"use strict";var b=a.i(92372);a.s([],29447),a.i(29447),a.s(["007459db64f988141da28e810b38601e5e8829989c",()=>b.checkApprovalStatus],77017)},89492,a=>{a.v(b=>Promise.all(["server/chunks/ssr/node_modules_@supabase_supabase-js_dist_module_index_13231ef2.js"].map(b=>a.l(b))).then(()=>b(24453)))}];

//# sourceMappingURL=_7317e907._.js.map