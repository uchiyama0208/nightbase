{"version":3,"sources":["../../../../../../apps/app/src/app/app/data-access.ts","../../../../../../apps/app/src/components/theme-provider.tsx/__nextjs-internal-proxy.mjs","../../../../../../apps/app/src/app/app/layout.tsx"],"sourcesContent":["import { cache } from \"react\";\nimport { createServerClient } from \"@/lib/supabaseServerClient\";\nimport { redirect } from \"next/navigation\";\n\nexport const getAppData = cache(async () => {\n    const supabase = await createServerClient();\n\n    const {\n        data: { user },\n    } = await supabase.auth.getUser();\n\n    if (!user) {\n        return { user: null, profile: null, theme: \"light\" as const };\n    }\n\n    // Optimize: Try to fetch everything in one go using deep embedding\n    // We assume 'users' has a foreign key 'current_profile_id' pointing to 'profiles'\n    // and 'profiles' has a foreign key 'store_id' pointing to 'stores'\n\n    // Note: We need to know the exact relationship name for the join.\n    // If explicit join fails, we might need to fall back or fix the relationship name.\n    // Based on standard Supabase generation, it might be 'profiles' or 'profiles_current_profile_id_fkey'\n\n    // Let's try a safe approach first: Fetch user config, then profile + store\n    // This is still better than 3 round trips if we cache it.\n\n    const { data: appUser } = await supabase\n        .from(\"users\")\n        .select(\"current_profile_id\")\n        .eq(\"id\", user.id)\n        .maybeSingle();\n\n    if (!appUser?.current_profile_id) {\n        return { user, profile: null, theme: \"light\" as const };\n    }\n\n    const { data: profile } = await supabase\n        .from(\"profiles\")\n        .select(\"*, stores(*)\")\n        .eq(\"id\", appUser.current_profile_id)\n        .maybeSingle();\n\n    const theme = (profile?.theme as \"light\" | \"dark\") || \"light\";\n\n    return { user, profile, theme };\n});\n","// This file is generated by next-core EcmascriptClientReferenceModule.\nimport { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport const ThemeProvider = registerClientReference(\n    function() { throw new Error(\"Attempted to call ThemeProvider() from the server but ThemeProvider is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/app/src/components/theme-provider.tsx\",\n    \"ThemeProvider\",\n);\nexport const useTheme = registerClientReference(\n    function() { throw new Error(\"Attempted to call useTheme() from the server but useTheme is on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/apps/app/src/components/theme-provider.tsx\",\n    \"useTheme\",\n);\n","import { ThemeProvider } from \"@/components/theme-provider\";\nimport { getAppData } from \"./data-access\";\n\nexport default async function AppRootLayout({\n    children,\n}: {\n    children: React.ReactNode;\n}) {\n    const { theme } = await getAppData();\n\n    return (\n        <ThemeProvider initialTheme={theme}>\n            <div className=\"min-h-screen bg-gray-50 dark:bg-gray-900\">\n                {children}\n            </div>\n        </ThemeProvider>\n    );\n}\n"],"names":[],"mappings":"uCAAA,IAAA,EAAA,EAAA,CAAA,CAAA,KACA,EAAA,EAAA,CAAA,CAAA,MAGO,IAAM,EAAa,CAAA,EAAA,EAAA,KAAA,AAAK,EAAC,UAC5B,IAAM,EAAW,MAAM,CAAA,EAAA,EAAA,kBAAA,AAAkB,IAEnC,CACF,KAAM,MAAE,CAAI,CAAE,CACjB,CAAG,MAAM,EAAS,IAAI,CAAC,OAAO,GAE/B,GAAI,CAAC,EACD,IADO,EACA,CAAE,KAAM,KAAM,QAAS,KAAM,MAAO,OAAiB,EAchE,GAAM,CAAE,KAAM,CAAO,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,SACL,MAAM,CAAC,sBACP,EAAE,CAAC,KAAM,EAAK,EAAE,EAChB,WAAW,GAEhB,GAAI,CAAC,GAAS,mBACV,CAD8B,KACvB,MAAE,EAAM,QAAS,KAAM,MAAO,OAAiB,EAG1D,GAAM,CAAE,KAAM,CAAO,CAAE,CAAG,MAAM,EAC3B,IAAI,CAAC,YACL,MAAM,CAAC,gBACP,EAAE,CAAC,KAAM,EAAQ,kBAAkB,EACnC,WAAW,GAEV,EAAS,GAAS,OAA8B,QAEtD,MAAO,MAAE,UAAM,QAAS,CAAM,CAClC,mDC5CA,IAAA,EAAA,EAAA,CAAA,CAAA,OACO,IAAM,EAAgB,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,2EACA,iBAES,EAAW,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC3C,WAAa,MAAM,AAAI,MAAM,8NAAgO,EAC7P,2EACA,8EATJ,IAAA,EAAA,EAAA,CAAA,CAAA,OACO,IAAM,EAAgB,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAChD,WAAa,MAAM,AAAI,MAAM,wOAA0O,EACvQ,uDACA,iBAES,EAAW,CAAA,EAAA,EAAA,uBAAA,AAAuB,EAC3C,WAAa,MAAM,AAAI,MAAM,8NAAgO,EAC7P,uDACA,wJCVJ,EAAA,EAAA,CAAA,CAAA,MACA,EAAA,EAAA,CAAA,CAAA,OAEe,eAAe,EAAc,UACxC,CAAQ,CAGX,EACG,GAAM,OAAE,CAAK,CAAE,CAAG,MAAM,CAAA,EAAA,EAAA,UAAA,AAAU,IAElC,MACI,CAAA,EAAA,EAAA,GAAA,EAAC,EAAA,aAAa,CAAA,CAAC,aAAc,WACzB,CAAA,EAAA,EAAA,GAAA,EAAC,MAAA,CAAI,UAAU,oDACV,KAIjB","ignoreList":[1]}